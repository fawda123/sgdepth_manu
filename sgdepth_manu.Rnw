\documentclass[letterpaper,12pt,oneside]{article}
\usepackage[paperwidth=8.5in,paperheight=11in,top=1in,bottom=1in,left=1in,right=1in]{geometry}
\usepackage{setspace}
\usepackage[colorlinks=true,allcolors=Blue]{hyperref}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{indentfirst}
\usepackage{titlesec}
\usepackage{multirow}
\usepackage{booktabs}
\usepackage{graphicx}
\usepackage{verbatim}
\usepackage{rotating}
\usepackage{tabularx}
\usepackage{outlines}
\usepackage{lineno}
\usepackage{array}
\usepackage{times}
\usepackage{cleveref}
\usepackage{acronym}
\usepackage[position=t]{subfig}
\usepackage{paralist}
\usepackage[noae]{Sweave}
\usepackage{natbib}
\usepackage{array}
\usepackage{pdflscape}
\usepackage{bm}
% \usepackage{showlabels}
\bibpunct{(}{)}{,}{a}{}{,}

% page margins and section title formatting
\linespread{1.5}
\setlength{\footskip}{0.5in}
\titleformat*{\section}{\Large\bf\em}
\titleformat*{\subsection}{\singlespace\large\bf}
\titleformat*{\subsubsection}{\singlespace\normalsize\bf\em}
\titlespacing{\section}{0in}{0in}{0in}
\titlespacing{\subsection}{0in}{0in}{0in}
\titlespacing{\subsubsection}{0in}{0in}{0in}

% cleveref options
\crefname{table}{Table}{Tables}
\crefname{figure}{Fig.}{Figs.}
\renewcommand{\figurename}{Fig.}

% aliased citations
\defcitealias{FLDEP12}{FLDEP 2012}
\defcitealias{HagyIR}{Hagy In review}
\defcitealias{USEPA06}{USEPA 2006}
\defcitealias{USEPA98}{USEPA 1998}

%acronyms
\acrodef{DEM}{Digital Elevation Model}
\acrodef{EPA}{Environmental Protection Agency}
\acrodef{doc}[$Z_c$]{depth of colonization}
\acrodef{GIS}{Geographic Information System}
\acrodef{IWR}{Impaired Waters Rule}
\acrodef{MSL}{mean sea level}
\acrodef{NAVD88}{North American Vertical Datum of 1988}
\acrodef{NOAA}{National Oceanic and Atmospheric Administration}

%knitr options
<<setup,include=F,cache=F>>=
library(knitr)
# set global chunk options
opts_chunk$set(fig.path = 'figs/', fig.align='center', fig.show='hold',message=F,echo=F,results='asis',dev='pdf',dev.args=list(family='serif'),fig.pos='!ht',warning=F)
options(replace.assign=TRUE,width=90,digits=1)
source('R/funcs.r')
@

\begin{document}

\raggedbottom
\linenumbers
\raggedright
\urlstyle{same}
\setlength{\parindent}{0.5in}
\renewcommand\refname{References \vspace{12pt}}

\begin{singlespace}
\title{{\bf {\Large Quantifying seagrass light requirements using an algorithm to spatially resolve depth of colonization}}}
\author{
  {\bf {\normalsize Marcus W. Beck$^1$, James D. Hagy III$^2$, Chengfeng Le$^3$}}
  \\\\{\textit {\normalsize $^1$ORISE Research Participation Program}}
  \\{\textit {\normalsize USEPA National Health and Environmental Effects Research Laboratory}}
  \\{\textit {\normalsize Gulf Ecology Division, 1 Sabine Island Drive, Gulf Breeze, FL 32561}}
	\\{\textit {\normalsize Phone: 850-934-2480, Fax: 850-934-2401, Email: \href{mailto:beck.marcus@epa.gov}{beck.marcus@epa.gov}}}
  \\\\{\textit {\normalsize $^2$USEPA National Health and Environmental Effects Research Laboratory}}
	\\{\textit {\normalsize Gulf Ecology Division, 1 Sabine Island Drive, Gulf Breeze, FL 32561}}
	\\{\textit {\normalsize Phone: 850-934-2455, Fax: 850-934-2401, Email: \href{mailto:hagy.jim@epa.gov}{hagy.jim@epa.gov}}}
  \\\\{\textit {\normalsize $^3$ORISE Research Participation Program}}
  \\{\textit {\normalsize USEPA National Health and Environmental Effects Research Laboratory}}
  \\{\textit {\normalsize Gulf Ecology Division, 1 Sabine Island Drive, Gulf Breeze, FL 32561}}
  \\{\textit {\normalsize Phone: 850-934-9308, Fax: 850-934-2401, Email: \href{mailto:le.chengfeng@epa.gov}{le.chengfeng@epa.gov}}}
	}
\date{}
\maketitle
\end{singlespace}
\clearpage

\section*{Abstract}

<<echo = F>>=
# load data
data(irl_light)
data(tb_light)
data(choc_light)
irl <- data.frame(irl_light)
tb <- data.frame(tb_light)
choc <- data.frame(choc_light)
@

Physiological relationships between water clarity and growth of submersed aquatic vegetation have been used to  characterize nutrient limits in aquatic systems.  Specifially, the maximum \ac{doc} is a useful measure of seagrass growth that describes response to light attenuation in the water column.  However, lack of standardization among methods for estimating \ac{doc} has limited the description of habitat requirements at relevant spatial scales.  An algorithm is presented for estimating seagrass \ac{doc} using geospatial datasets that are commonly available for coastal regions.  A defining characteristic of the algorithm is the ability to estimate \ac{doc} using a flexible spatial unit such that the quantified values can be appplied to a specific area of interest.  These spatially-resolved estimates of \ac{doc} can then be related to light attenuation to develop a characterization of factors that limit seagrass growth, such as minimum light requirements at depth.  Four distinct coastal regions of Florida were evaluated to describe heterogeneity in seagrass growth patterns on relatively small spatial scales.  The analysis was extended to entire bay systems using \ac{doc} and satellite-derived light attenuation to quantify minimum light requirements on a broad scale using a systematic spatial context.  Sensitivity analyses indicated that confidence intervals for \ac{doc} were within reasonable limits for each case study, although the ability to quantify \ac{doc} varied with characteristics of the sampled data.  \ac{doc} estimates also varied along water quality gradients such that seagrass growth was more limited near locations with reduced water clarity. Site-specific characteristics that contributed to variation in growth patterns were easily distinguished using the algorithm as compared to more coarse estimates of \ac{doc}.  Minimum light requirements for the Indian River Lagoon (\Sexpr{mean(irl$light)}\%) on the Atlantic Coast were substantially lower than those for Tampa Bay (\Sexpr{mean(tb$light)}\%) and Choctawhatchee Bay (\Sexpr{mean(choc$light)}\%) on the Gulf Coast.  High light requirements for the Gulf Coast may indicate regional differences in species requirements or additional factors, such as epiphyte growth, that further reduce light availability at the leaf surface.  A spatially robust characterization of seagrass \ac{doc} is possible for other regions because the algorithm is transferable with minimal effort to novel datasets.

\noindent \textit{Key words}: depth of colonization, estuary, Florida, light requirements, seagrasses, water clarity

\clearpage

\acresetall

\section{Introduction}

Seagrasses are ecologically valuable components of aquatic systems that have a critical role in shaping aquatic habitat.  These `ecosystem engineers' influence multiple characteristics of aquatic systems through interactions with many biological and abiotic components \citep{Jones94,Koch01}.  For example, seagrass beds create habitat for juvenile fish and invertebrates by reducing wave action and stabilizing sediment \citep{williams01,Hughes09}.  Seagrasses also respond to changes in water clarity through physiological linkages with light availability.  Seagrass communities in productive aquatic systems may be light-limited as increased nutrient loading reduces water clarity through increased algal concentration \citep{Duarte95}.  Empirical relationships between nutrient loading, water clarity, light requirements, and the maximum depth of seagrass colonization have been identified \citep{Duarte91,Kenworthy96,Choice14} and are often used to characterize light regimes sufficient to maintain habitat \citep{Steward05}.  Seagrass depth limits have also been used to establish quantititative criteria for nutrient load targets for the maintenance of water quality \citep{Janicki96}.  Seagrasses are integrative of system-wide conditions over time in relation to changes in nutrient regimes \citep{Duarte95} and are often preferred biological endpoints to describe ecosytem response to perturbations relative to more variable taxa (e.g., phytoplankton).  Quantifying the relationship of seagrasses with water clarity is a useful approach to understanding ecological characteristics of aquatic systems with potential insights into system response to disturbance \citep{Greve05}.    

Many techniques have been developed for estimating seagrass depth limits to better understand water quality dynamics.  Such efforts have been useful for site-specific approaches where the analysis needs are driven by a particular question \citep[e.g.,][]{Iverson86,Hale04}. However, lack of standardization among methods has prevented broad-scale comparisons between regions and has even contributed to discrepancies between measures based on the technique \citep{Spears09}.  The availability of geospatial data that describe areal seagrass and bathymetric coverage suggests standardized techniques can be developed that could be applied across broad areas.  Conversely, site-specific approaches with such datasets typically quantify habitat requirements within predefined management units that may prevent generalizations outside of the study area. For example, \cite{Steward05} describe use of a segmentation scheme for the Indian River Lagoon on the Atlantic coast of Florida to assign seagrass depth limits to 19 distinct geospatial units.  Although useful for the specific study goals, substantial variation in growth patterns and water quality characteristics at different spatial scales may prevent more detailed analyses.  Methods for estimating seagrass depth limits should also be reproducible for broad-scale comparisons, while also maintaining flexibility based on the objectives. Such techniques can facilitate comparisons between regions given the spatial coverage and annual availability of many geospatial data sources.  

Estimating seagrass light requirements is a useful application of maximum depth limits and water clarity data.  Although growth of submersed aquatic plants is generally most limited by light availability \citep{Barko82,Hall90,Dennison93}, substantial variation in light requirements in the same community or between regions may suggest additional factors are limiting \citep{Dennison93,Choice14}.  Minimum light requirements for seagrasses are on average 11\% of surface irradiance \citep{Duarte91}, although values may range from less than 5\% to greater than 30\% depending on site conditions \citep{Dennison93}. Substantial variation in light requirements has been observed between species or based on regional differences in community attributes.  For example, significant variation in light requirements for the Gulf Coast of Florida were attributed to morphological and physiological differences between species and adaptations to regional light regimes \citep{Choice14}. Additional factors may also contribute to high estimates of light requirements, such as excessive epiphytic algal growth that reduces light availability on the leaf surface \citep{Kemp04}. Spatial heterogeneity in light requirements is, therefore, a useful diagnostic tool for identifying factors that affect seagrass growth. 

In addition to accurate measures of depth of colonization, the availability of water clarity data that are evenly distributed through space in time has also limited estimates of seagrass light requirements.  Secchi observations can provide reliable measures of water clarity \citepalias{USEPA06}, although data can be biased by location.  Monitoring programs may have unbalanced coverage of aquatic resources with greater perceived importance relative to those that may have more ecological significance \citep{Wagner08,Lottig14}.  Morever, infrequent field measurements that are limited to discrete time periods are more descriptive of short-term variability rather than long-term trends in water clarity \citep{Elsdon09}.  Seagrasses growth patterns are integrative of seasonal and inter-annual patterns in water clarity, such that estimates of light requirements may be limited if water clarity measurements inadequately describe temporal variation.  Remote sensing products can provide reliable estimates of water clarity and could be used to develop a more complete description of relevant ecosystem characteristics.  Although algorithms have been developed for coastal waters to estimate surface reflectance from satellite data \citep{Woodruff99,Chen07}, this information has rarely been used to describe seagrass light requirements at a spatial resolution consistent with most remote sensing products.    

Quantitative and flexible methods for estimating seagrass depth limits and light requirements can improve descriptions of aquatic habitat, thus enabling potentially novel insights into ecological characteristics of aquatic systems.  This article describes a method for estimating seagrass depth of colonization using geospatial datasets to create a spatially-resolved and flexible measure.  In particular, an empirical algorthm is described that estimates seagrass depth limits from coverage maps and bathymetric data using an \textit{a priori} defined area of influence. These estimates are combined with measures of water clarity to develop a spatial characterization of light requirements.  The specific objectives are to\begin{inparaenum}[1\upshape)]
\item describe the method for estimating seagrass depth limits, 
\item apply the technique to four distinct regions of Florida to illustrate improved clarity of description, and
\item develop a spatial description of depth limits, water clarity, and light requirements for the case studies.  
\end{inparaenum}
The method is first illustrated using four relatively small areas of larger coastal regions followed by extension to entire estuaries to characterize spatial variation in light requirements, within and between regions.  Overall, these methods inform the description of seagrass growth patterns by developing a more spatially relevant characterization of aquatic habitat.  The method is applied to data from Florida, although the technique is easily transferable to other regions with comparable data. 

\section{Methods}

Estimates of seagrass \ac{doc} derived from relatively broad spatial areas, such as predefined management units, may not fully describe relevant variation depending on the question of interest. \Cref{fig:buff_ex1} shows variation in seagrass distribution for a management segment (thick polygon) in the Big Bend region of Florida.  The maximum depth colonization, as a red countour line, is based on a segment-wide estimate of all seagrasses within the polygon.  Although the estimate is not inaccurate, substantial variation in seagrass growth patterns at smaller spatial scales is not adequately described. In particular, \ac{doc} is greatly over-estimated at the outflow of the Steinhatchee River (northeast portion of the segment) where high concentrations of dissolved organic matter reduce water clarity and naturally limit seagrass growth (personal communication, Nijole Wellendorf, Florida Department of Environmental Protection).  This example suggests that it may be useful to have improved spatial resolution in \ac{doc}, particularly when site-specific characteristics require a more detailed description.  The following is a summary of data sources, methods, and rationale for developing the algorithm.  Data and methods described in \citetalias{HagyIR} are used as a foundation for developing the approach.

\subsection{Data sources}

\subsubsection{Study sites}

Four coastal locations in Florida were used as study sites: the Big Bend region (northeast Gulf of Mexico), Choctawhatchee Bay (panhandle), Tampa Bay (central Gulf Coast), and Indian River Lagoon (Atlantic coast) (\cref{tab:seg_summ,fig:seg_all}).  Sites were chosen to represent a regional distribution of coastal habitat in Florida, in addition to having available data and observed gradients in water quality. Site-specific estimates of seagrass depth colonization and light requirements were the focus of the current analysis, with emphasis on improved clarity of description with changes in spatial context.  However, coastal regions and estuaries in Florida are partitioned using a predefined segmentation scheme for developing numeric nutrient criteria.  These management segments are used for comparison to evaluate variation in growth patterns at difference spatial scales.  One segment within each region and smaller spatial units defined by the algorithm are first evaluated to illustrate use of the method.  Segments in each region included a location near the outflow of the Steinhatchee River for the Big Bend region, Old Tampa Bay, Upper Indian River Lagoon, and Western Choctawhatchee Bay (\cref{fig:seg_all}).  A second analysis focused on describing seagrass depth limits for all of Choctawhatchee Bay, Tampa Bay, and the Indian River Lagoon to develop a spatial description of light requirements.

\subsubsection{Seagrass coverage and bathymetry} \label{sec:data_srcs}

Geospatial data describing seagrass areal coverage combined with co-located bathymetric depth maps were used to estimate \ac{doc}.  These products are publically available in coastal regions of Florida through the US Geological Survey, Florida Department of Environmental Protection, Florida Fish and Wildlife Conservation Commission, and many watershed management districts.  Seagrass coverage maps were obtained for one chosen year in each of the study sites (\cref{tab:seg_summ}).  The original coverage maps were produced using photo-interpretations of aerial images to categorize seagrass as absent, discontinuous (patchy), or continuous.  We considered only present (continuous and patchy) and absent categories since differences between continuous and patchy coverage were often inconsistent between data sources. 

Bathymetric depth maps were obtained from the National Oceanic and Atmospheric Administration's (\acsu{NOAA}) National Geophysical Data Center (\url{http://www.ngdc.noaa.gov/}) as either \acp{DEM} or raw sounding data from hydroacoustic surveys.  Tampa Bay data provided by the Tampa Bay National Estuary Program are described in \citet{Tyler07}. Bathymetric data for the Indian River Lagoon were obtained from the St. John's Water Management District \citep{CPE97}.  The vertical datums varied such that \ac{NOAA} products were referenced to mean lower low water, Tampa Bay data were referenced to the \ac{NAVD88}, and the Indian River Lagoon data were referenced to mean sea level.  All bathymeric data were vertically adjusted to local \ac{MSL} using the \ac{NOAA} VDatum tool (\url{http://vdatum.noaa.gov/}). Adjusted data were combined with seagrass coverage layers using standard union techniques for raster and vector layers in ArcMap 10.1 \citep{ESRI12}.  To reduce computation time, depth layers were first masked using a 1 km buffer of the seagrass coverage layer.  Raster bathymetric layers were converted to vector point layers to combine with seagrass coverage maps, described below.  

\subsubsection{Water clarity estimates} \label{sec:clar_est}

Spatial variatoin in light requirements were explored using \ac{doc} and water clarity estimates for the entire areas of Choctawhatchee Bay, Tampa Bay, and the Indian River Lagoon. Limited clarity data in the Big Bend region prohibited analysis in this location.  Satellite images were used to create a gridded 1 km$^2$ map as estimated water clarity (m, Tampa Bay) or light extinction ($K_d$, m$^{-1}$, Choctawhatchee Bay).  Secchi data were used directly to evaluate light requirements for the Indian River Lagoon because satellite data were inestimable.

Daily MODIS (Aqua level-2) satellite data for the preceding five years from the seagrass coverage layer for Tampa and Choctawhatchee Bays were downloaded from the NASA website (\url{http://oceancolor.gsfc.nasa.gov/}). Images were reprocessed using the SeaWiFS Data Analysis System software (SeaDAS, Version 7.0). In Tampa Bay, water clarity was derived from daily MODIS images using a previously-developed algorithm \citep{Chen07}. Monthly and annual mean water clarity were calculated from the daily images and then averaged to create a single layer. Similarly, $K_d$ in Choctawhatchee bay was derived from MODIS using the QAA algorithm \citep{Lee05}.  Field measurements of $K_d$ for 2010 obtained at ten locations in Choctawhatchee Bay at monthly intervals were used to correct the unvalidated satellite $K_d$ values.  Specifially, annual mean field measurements of $K_d$ were compared to the annual mean satellite estimates in 2010.  An empirical correction equation was developed based on the difference between the cumulative distribution of the in situ $K_d$ estimates and the satellite estimated $K_d$ at the same locations.  The 2010 correction was applied to all five years of annual mean satellite data prior to averaging to create a single layer for further analysis.

Satellite estimates of water clarity were unobtainable in the Indian River Lagoon because of significant light scattering from bottom reflectance and limited resolution for narrow segments along the north-south axis.  Secchi data (meters, $Z_{secchi}$) within the previous ten years of the seagrass coverage data (i.e., 1999--2009) were obtained from update 40 of the \ac{IWR} database for all of the Indian River Lagoon.  More than five years of clarity data were used for Indian River Lagoon due to uneven temporal coverage.  Stations with less than five observations and observations that were flagged in the database indicating that the value was lower than the maximum depth of the observation point were removed.  Secchi data were also compared with bathymetric data to verify unflagged values were not missed by initial screening. 

\subsection{Estimation of seagrass depth of colonization} \label{sec:est_method}

The approach to estimating seagrass \acl{doc} uses combined seagrass coverage maps and bathymetric depth data described above.  The combined layer was a point shapefile with attributes describing location (latitude, longitude), depth (m), and seagrass (present, absent).  Seagrass \ac{doc} values were estimated from these data by quantifying the proportion of points with seagrass at each observed depth.  Three unique measures obtained from these data are minimum ($Z_{c,\,min}$), median ($Z_{c,\,med}$), and maximum ($Z_{c,\,max}$) \acl{doc}.  Operationally, these terms describe characteristics of the seagrass coverage map with quantifiable significance. $Z_{c,\,max}$ is the deepest depth at which a significant coverage of mappable seagrasses occured independent of outliers, whereas  $Z_{c,\,med}$ is the median depth occurring at the deep water edge. $Z_{c,\,min}$ is the depth at which seagrass coverage begins to decline with increasing depth and may not be statistically distinguishable from zero depth, particularly in turbid waters.

The spatially-resolved approach for estimating \ac{doc} begins by choosing an explicit location in cartesian coordinates within the general boundaries of the available data.  Seagrass depth data (i.e., merged bathymetric and seagrass coverage data) that are located within a set radius from the chosen location are selected for estimating seagrass \ac{doc} values (sample areas in \cref{fig:buff_ex}). The estimate for each location is quantified from the proportion of sampled points that contain seagrass at decreasing 0.1 meter depth bins from the surface to the maximum depth in the sample (\cref{fig:est_ex1}).  Although the chosen radius for selecting data is problem-specific, the minimum radius should be large enough to sample a sufficient number of points for estimating \ac{doc}.  In general, a sufficient radius will produce a plot that indicates a decrease in the proportion of points that are occupied by seagrass with increasing depth. Plots with insufficient data may indicate a reduction of seagrass with depth has not occurred (e.g.,  nearshore areas) or seagrasses simply are not present.  If more than one location is used to estimate \ac{doc} (as in \cref{fig:buff_ex}), radii for each pointshould be chosen to reduce overlap with the seagrass depth data sampled by neighboring points.     

For each location, a curve is fit to the sampled depth points using non-linear regression to characterize the reduction in seagrass as a function of depth (\cref{fig:est_ex2}).  Specifically, a decreasing logistic growth curve is used with the assumption that seagrass decline with increasing depth is monotonic from the minimum depth of colonization followed by a gradual decline at the maximum depth.  The function is asymptotic at the minimum and maximum depths of colonization to constrain the estimates within the data domain. The curve is fit by minimizing the residual sums-of-squares with the Gauss-Newton algorithm \citep{Bates92} with starting parameters estimated from the observed data that are initial approximations of the curve characteristics.  The model has the following form:
\begin{equation} \label{eqn:prop}
 Proportion = \frac{\alpha}{1 + \mathrm{e}^{{\left(\beta - Z\right)/\gamma}}}
\end{equation}
where the proportion of points occupied by seagrass at each depth, $Z$, is defined by a logistic curve with an asymptote $\alpha$, a midpoint inflection $\beta$, and a scale parameter $\gamma$.  Finally, a simple linear curve is fit through the inflection point ($\beta$) of the logistic curve to estimate the three measures of depth of colonization (\cref{fig:est_ex3}).  The inflection point is considered the depth at which seagrass are decreasing at a maximum rate and is used as the slope of the linear curve.  The maximum depth of seagrass colonization, $Z_{c,\,max}$, is the x-axis intercept of the linear curve.  The minimum depth of seagrass growth, $Z_{c,\,min}$, is the location where the linear curve intercepts the upper asymptote of the logistic growth curve.  The median depth of seagrass colonization, $Z_{c,\,med}$, is the halfway between $Z_{c,\,min}$ and $Z_{c,\,max}$.  $Z_{c,\,med}$ is not always the inflection point of the logistic growth curve.

Estimates for each of the three \ac{doc} measures are obtained only if specific criteria are met.  These criteria were implemented as a safety measure that ensures a sufficient amount and appropriate quality of data were sampled within the chosen radius.  First, estimates were provided only if a sufficient number of seagrass depth points were present in the sampled data to estimate a logistic growth curve.  This criteria applies to the sample size as well as the number of points with seagrass in the sample.  Second, estimates were provided only if an inflection point was present on the logistic curve within the range of the sampled depth data.  This criteria applied under two scenarios where the curve was estimated but a trend was not adequately described by the sampled data.  That is, estimates were unavailable if the logistic curve described only the initial decrease in points occupied as a function of depth.  The opposite scenario occurred when a curve was estimated but only the deeper locations beyond the inflection point were present in the sample.  Third, the estimate for $Z_{c,\,min}$ was set to zero depth if the linear curve through the inflection point intercepted the upper asymptote of the logistic curve at x-axis values less than zero.  The estimate for $Z_{c,\,med}$ was also shifted to the depth value halfway between $Z_{c,\,min}$ and $Z_{c,\,max}$ if $Z_{c,\,min}$ was fixed at zero.  Finally, estimates were considered invalid if the 95\% confidence interval for $Z_{c,\,max}$ included zero.  In such cases, the three measures are not statistically distinguishable, although a useful estimate for $Z_{c,\max}$ is provided.  Methods to determine confidence bounds are described below.  

\subsection{Estimating uncertainty in \acl{doc} estimates}

Confidence intervals for the \ac{doc} values were estimated using a Monte Carlo simulation approach that used the variance-covariance matrix of the logistic model parameters \citep{Hilborn97}.  Confidence intervals were constructed by repeated sampling of a multivariate normal distribution to evaluate the uncertainty in the inflection point in \cref{eqn:prop}.  The sampling distribution assumes:
\begin{equation}
x \sim N(\mu, \Sigma)
\end{equation}
\noindent where $x$ is a predictor variable used in \cref{eqn:prop} (depth) that follows a multivariate normal distribution with mean $\mu$, and variance-covariance matrix $\Sigma$.  The mean values are set at the depth value corresponding to the inflection point on the logistic curve from the observed model, whereas $\Sigma$ is the variance-covariance matrix of the model parameters ($\alpha$, $\beta$, $\gamma$).  A large number of samples ($n = 10000$) were drawn from the distribution to characterize the uncertainty of the depth value of the inflection point.  The 2.5\textsuperscript{th} and 97.5\textsuperscript{th} percentiles of the sample were considered bounds on the 95\% confidence interval.  This approach was used because uncertainty from the logistic curve is directly related to uncertainty in each of the \ac{doc} estimates that are based on the linear curve through the inflection point. Upper and lower limits for each \ac{doc} estimate were obtained by fitting new linear curves through the upper and lower limits of the initial depth value. (i.e., \cref{fig:est_ex3}).

Nonlinear least squares models were based on the \texttt{nls} and \texttt{SSlogis} functions that used a self-starting logistic growth model \citep{Bates92,RDCT14}.  Multivariate normal distributions were simulated using functions in the MASS package \citep{Venables02}.  Geospatial data were imported and processed using functions in the rgeos and sp packages \citep{Bivand08,Bivand14}.  

\subsection{Evaluation of spatial heterogeneity of seagrass depth limits}

Spatially-resolved estimates for seagrass \ac{doc} were obtained for several locations in each of the four segments described above (\cref{fig:seg_all}).  A regular grid of locations for estimating each of the three \ac{doc} values was created for each segment.  The grid was masked by the segment boundaries, whereas seagrass depth points used to estimate \ac{doc} extended slightly beyond the segment boundaries to allow adequate sampling by grid points that occurred near the edge.  Spacing between sample points was chosen arbitrarily as 0.01 decimal degrees (~1 km at 30 degrees N latitude) and the sampling radius for each location was chosen as 0.02 decimal degrees.  The sample radius allowed for complete coverage of seagrass within the segment while also minimizing redundancy of information described by each location.  Finally, a single segment-wide estimate using all data at each location was used for comparisons.  Departures from the segment-wide estimate at finer scales were considered evidence of spatial heterogeneity in seagrass growth and improved clarity of description as a result.  

\subsection{Estimating light requirements}

Relationships between seagrass depth limits and water clarity were explored by estimating light requirements for the entire areas of Choctawhatchee Bay, Tampa Bay, and Indian River Lagoon.  Seagrass depth limits that were co-located with estimates of water clarity, either as satellite-based estimates or in situ secchi observations, were related using empirical light attenuation equations.  The Lambert-Beer equation describes the exponential decrease of light availability with depth:
\begin{equation} \label{eqn:lambeer}
I_{z} = I_{O} \cdot \exp\left(-K_{d} \cdot Z\right)
\end{equation}
\noindent such that the irradiance of incident light at depth $Z$ ($I_{Z}$) can be estimated from the irradiance at the surface ($I_{O}$) and a light extinction coefficient ($K_{d}$). Light requirements of seagrass can be estimated by rearranging \cref{eqn:lambeer}:
\begin{equation} \label{eqn:perclight}
\% \ light = \exp\left(-K_{d} \cdot Z_{c,\,max}\right)
\end{equation}
\noindent where the percent light requirements are a function of the estimated $Z_{c,\,max}$ and light extinction. If $K_d$ estimates are unavailable, a conversion factor can be used to estimate the light extinction coefficient from secchi depth $Z_{secchi}$, such that $c = K_{d} \cdot Z_{secchi}$, where $c$ has been estimated as 1.7 \citep{Poole29,Idso74}:
\begin{equation} \label{eqn:cperclight}
\% \ light = \exp\left(-\left(\frac{1.7}{Z_{secchi}}\right)\cdot Z_{c,\,max}\right)
\end{equation}

Two approaches were used to estimate light requirements based on the availability of satellite data or in situ water clarity (see \label{sec:clar_est}).  For locations with satellite data (Choctawhatchee and Tampa Bay), a regular grid of sampling points was created as before to estimate $Z_{c,\,max}$ and sample the continuous layer of satellite-derived water clarity.  Grid spacing was different in each bay (0.005 for Choctawhatchee Bay, 0.01 for Tampa Bay) to account for variation in spatial scales of seagrass coverage.  \Cref{eqn:perclight} was used to estimate light requirements at each point for Choctawhatchee Bay and \cref{eqn:cperclight} was used for Tampa Bay.  Similarly, the geographic coordinates for each in situ secchi measurement in the Indian River Lagoon were used as locations for estimating $Z_{c,\,max}$ and light requirements using \cref{eqn:cperclight}.  Excessively small estimates for light requirements were removed for Indian River Lagoon which were likely caused by shallow secchi observations that were not screened during initial data processing.  A critical difference between the satellite and secchi data was that a more complete spatial description of light requirements was possible in the former case due to continuous coverage, whereas descriptions using secchi data were confined to the original sampling locations.  Sampling radii for locations in each bay were chosen to maximize the number of points with estimable values for $Z_{c,\,max}$ (as described in \cref{sec:est_method}), while limiting the upper radius to adequately describe variation in seagrass growth patterns for emphasizing gradients in light requirements. Radii were fixed at 0.04 decimal degrees for Choctawhatchee Bay, 0.1 decimal degrees for Tampa Bay, and 0.15 decimal degrees for Indian River Lagoon.

\section{Results}

\subsection{Segment characteristics and seagrass depth estimates}

% data for inline expressions
<<echo = F>>=
data(seg_summ)

# surface areas
areas <- seg_summ[row.names(seg_summ) %in% 'Surface area',]
areas <- as.numeric(areas)
names(areas) <- names(seg_summ)

# seagrass percent coverage
sgperc <- seg_summ[row.names(seg_summ) %in% 'Seagrass area',]
sgperc <- 100 * as.numeric(sgperc) / areas
names(sgperc) <- names(seg_summ)

# mean depth
depths <- seg_summ[row.names(seg_summ) %in% 'Depth (mean)',]
depths <- as.numeric(depths)
names(depths) <- names(seg_summ)

#max depths
mdepths <- seg_summ[row.names(seg_summ) %in% 'Depth (max)',]
mdepths <- as.numeric(mdepths)
names(mdepths) <- names(seg_summ)

# secchi depths
secchis <- seg_summ[row.names(seg_summ) %in% 'Secchi (mean)',]
secchis <- as.numeric(secchis)
names(secchis) <- names(seg_summ)
@

Each coastal region varied by several characteristics that potentially explain variation of seagrass growth (\cref{tab:seg_summ}).  Mean surface area was \Sexpr{mean(areas)} square kilometers, with area decreasing for the Big Bend (\Sexpr{areas['Big Bend']} km), Upper Indian River Lagoon (\Sexpr{areas['Upper Indian River Lagoon']} km), Old Tampa Bay (\Sexpr{areas['Old Tampa Bay']} km), and Choctawhatchee Bay (\Sexpr{areas['W. Choctawhatchee Bay']} km) segments.  Mean depth was less than 5 meters for each segment, excluding Western Choctawhatchee Bay which was slightly deeper than the other segments (\Sexpr{depths['W. Choctawhatchee Bay']} m).  Maximum depths were considerably deeper for Choctawhatchee Bay (\Sexpr{mdepths['W. Choctawhatchee Bay']} m) and Old Tampa Bay (\Sexpr{mdepths['Old Tampa Bay']} m), as compared to the Big Bend (\Sexpr{mdepths['Big Bend']} m) and Indian River Lagoon (\Sexpr{depths['Upper Indian River Lagoon']} m) segments. Seagrasses covered a majority of the surface area for the Big Bend segment (\Sexpr{sgperc['Big Bend']} \%), whereas coverage was much less for Upper Indian River Lagoon (\Sexpr{sgperc['Upper Indian River Lagoon']} \%), Old Tampa Bay (\Sexpr{sgperc['Old Tampa Bay']} \%), and Western Choctawhatchee Bay (\Sexpr{sgperc['W. Choctawhatchee Bay']} \%).  Visual examination of the seagrass coverage maps for the respective year of each segment indicated that seagrasses were not uniformly distributed (\cref{fig:seg_all}).  Seagrasses in Western Choctawhatchee Bay were sparse with the exception of a large patch located to the west of the inlet connection with the Gulf of Mexico.  Seagrasses in the Big Bend segment were located throughout with noticeable declines near the outflow of the Steinhatchee River, whereas seagrasses in Old Tampa Bay and Upper Indian River Lagoon were generally confined to shallow areas near the shore. Seagrass coverage showed a partial decline toward the northern ends of both Old Tampa Bay and Upper Indian River Lagoon segments.  Water clarity as indicated by average secchi depths was similar between the segments (\Sexpr{mean(secchis)} m), although Choctawhatchee Bay had a slightly higher average (\Sexpr{secchis['W. Choctawhatchee Bay']} m).     

% seagrass estimates from table
<<echo = F>>=
data(ests_seg)
data(ests_out)

# big bend doc max diff
bb_ests <- mean(ests_out[ests_out$seg == '820', 'z_cmax'])

# irl estimates
irl_maxdocmin <- max(ests_out[ests_out$seg == '1502', c('z_cmin')])
irl_meandocmax <- mean(ests_out[ests_out$seg == '1502', c('z_cmax')])
irl_maxdocmax <- max(ests_out[ests_out$seg == '1502', c('z_cmax')])
@

The segment-wide estimates of \ac{doc} indicated that seagrasses generally did not grow deeper than three meters in any of the segments (\cref{tab:est_summ}).  Maximum and median depth of colonization were deepest for the Big Bend segment (\Sexpr{ests_seg[ests_seg$seg == '820', 'z_cmax']} and \Sexpr{ests_seg[ests_seg$seg == '820', 'z_cmed']} m, respectively) and shallowest for Old Tampa Bay (\Sexpr{ests_seg[ests_seg$seg == '902', 'z_cmax']} and \Sexpr{ests_seg[ests_seg$seg == '902', 'z_cmed']} m), whereas the minimum depth of colonization was deepest for Western Choctawhatchee Bay (\Sexpr{ests_seg[ests_seg$seg == '303', 'z_cmin']} m) and shallowest for Old Tampa Bay (\Sexpr{ests_seg[ests_seg$seg == '902', 'z_cmin']} m).  In most cases, the averages of all grid-based estimates were less than the whole segment estimates, indicating a left-skewed distribution of estimates at finer spatial scales.  For example, the average of all grid estimates for $Z_{c,\,max}$ in the Big Bend region indicated seagrasses grew to approximately \Sexpr{bb_ests} m, which was \Sexpr{ests_seg[ests_seg$seg == '820', 'z_cmax'] - bb_ests} m less than the whole segment estimate.  Although reductions were not as severe for the average grid estimates for the remaining segments, considerable within-segment variation was observed depending on grid location.  For example, the deepest estimate for $Z_{c,\,min}$ (\Sexpr{irl_maxdocmin} m) in the Upper Indian River Lagoon exceeded the average of all grid locations for $Z_{c,\,max}$ (\Sexpr{irl_meandocmax} m).  $Z_{c,\,min}$ also had minimum values of zero meters for the Big Bend and Old Tampa Bay segments, suggesting that seagrasses declined continously from the surface for several locations.   

Visual interpretations of the grid estimates provided further information on the distribution of seagrasses in each segment (\cref{fig:all_ests}).  Spatial heterogeneity in depth limits was particularly apparent for the Big Bend and Upper Indian River Lagoon segments.  As expected, depth estimates indicated that seagrasses grew deeper at locations far from the outflow of the Steinhatchee River in the Big Bend segment.  Similarly, seagrasses were limited to shallower depths at the north end of the Upper Indian River Lagoon segment near the Merrit Island National Wildlife Refuge. Seagrasses were estimated to grow at maximum depths up to \Sexpr{irl_maxdocmax} m on the eastern portion of the Upper Indian River Lagoon segment.  Spatial heterogeneity was less distinct for the remaining segments although some patterns were apparent.  Seagrasses in Old Tampa Bay grew slightly deeper in the northeast portion of the segment and declined to shallower depths near the inflow at the northern edge.  Spatial variation in Western Choctawhatchee Bay was minimal, although the maximum \ac{doc} estimate was observed in the northeast portion of the segment.  As expected, \ac{doc} values could not be estimated where seagrasses were sparse or absent, nor where seagrasses were present but the sampled points did not show a decline with depth.  The former scenario was most common in Old Tampa Bay and Western Choctawhatchee Bay where seagrasses were unevenly distributed or confined to shallow areas near the shore.  The latter scenario was most common in the Big Bend segment where seagrasses were abundant but locations near the shore were inestimable given that seagrasses did not decline appreciably within the depths that were sampled.   

<<echo = F>>=
data(ests_out)
data(ests_out_nonsigs)

# uncertainty means
means <- dplyr::group_by(ests_out, seg) %>% 
  summarize(means = mean(confint, na.rm = T)) %>% 
  as.data.frame(.)

# uncertainty means
maxs <- dplyr::group_by(ests_out, seg) %>% 
  summarize(maxs = max(confint, na.rm = T)) %>% 
  as.data.frame(.)

# percent non-overlapping
# 'overlapped' indicates percent non-different between depth measures
# interval is non-symmetric but this does not affect overlap
overlap <- dplyr::mutate(ests_out, halved = confint/2) %>% 
  mutate(
    overlapped = (z_cmax - halved) < (z_cmed + halved)
  ) %>% 
  group_by(seg) %>% 
  summarize(
    overlapped = 100 * sum(overlapped)/length(overlapped)
  ) %>% 
  as.data.frame(.)

# of those that were estimable, which had z_cmax sig greater than zero?
nonsigs <- dplyr::mutate(ests_out_nonsigs,
    ltzero = lower_max < 0
  ) %>% 
  group_by(seg) %>% 
  summarize(
    ltzero = 100 * sum(ltzero)/length(ltzero)
  ) %>% 
  as.data.frame(.)

@
Uncertainty in $Z_{c,\,max}$ indicated that confidence intervals were generally acceptable (i.e., greater than zero), although the ability to discriminate between the three depth estimates varied by segment (\cref{fig:all_ests,tab:sens_summ}). Uncertainty for all estimates as the average width of the 95\% confidence intervals for all segments was \Sexpr{mean(ests_out$confint, na.rm = T)} m.  Greater uncertainty was observed for Western Choctawhatchee Bay (mean width was \Sexpr{means[means$seg == '303', 'means']} m) and Old Tampa Bay (\Sexpr{means[means$seg == '902', 'means']} m), compared to the Big Bend (\Sexpr{means[means$seg == '820', 'means']} m) and Upper Indian River Lagoon (\Sexpr{means[means$seg == '1502', 'means']} m) segments.  The largest confidence interval for each segment was \Sexpr{maxs[maxs$seg == '902', 'maxs']} m for Old Tampa Bay, \Sexpr{maxs[maxs$seg == '303', 'maxs']} m for Western Choctawhatchee Bay, \Sexpr{maxs[maxs$seg == '820', 'maxs']} m for the Big Bend, and \Sexpr{maxs[maxs$seg == '1502', 'maxs']} m for the Upper Indian River Lagoon segments.  Most confidence intervals for the remaining grid locations were much smaller than the maximum in each segment (e.g., an extreme central location of the Upper Indian River Lagoon, \cref{fig:all_ests}).  A comparison of overlapping confidence intervals for $Z_{c,\,min}$, $Z_{c,\,med}$, and $Z_{c,\,max}$ at each grid location indicated that not every measure was unique.  Specifically, only \Sexpr{100 - overlap[overlap$seg == '303', 'overlapped']}\% of grid points in Choctawhatchee Bay and \Sexpr{100 - overlap[overlap$seg == '902', 'overlapped']}\% in Old Tampa Bay had significantly different estimates, whereas \Sexpr{100 - overlap[overlap$seg == '1502', 'overlapped']}\% of grid points in the Indian River Lagoon and \Sexpr{100 - overlap[overlap$seg == '820', 'overlapped']}\% of grid points in the Big Bend segments had estimates that were significantly different.  By contrast, all grid estimates in Choctawhatchee Bay and Indian River Lagoon had $Z_{c,\,max}$ estimates that were significantly greater than zero, whereas all but \Sexpr{nonsigs[nonsigs$seg == '902', 'ltzero']}\% of grid points in Old Tampa Bay and \Sexpr{nonsigs[nonsigs$seg == '820', 'ltzero']}\% of grid points in the Big Bend segment had $Z_{c,\,max}$ estimates significantly greater than zero. 

\subsection{Evaluation of seagrass light requirements}

Estimates of water clarity, seagrass depth limits, and corresponding light requirements for all locations in Choctawhatchee Bay, Tampa Bay, and the Indian River Lagoon indicated substantial variation, both between and within the different bays.  Satellite-derived estimates of light attenuation for Choctawhatchee Bay (as $K_d$, \cref{fig:kd_choc}) and Tampa Bay (as clarity, \cref{fig:clarity_tb}) indicated variation between years and along major longitudinal and lateral axes.  For Choctawhatchee Bay, $K_d$ estimates for western and central segments were substantially smaller than those for the more shallow, eastern segment.  Maximum $K_d$ values were also observed in earlier years (e.g., 2003, 2004).  Clarity estimates for Tampa Bay also showed an increase towards more seaward segments, with particularly higher clarity along the mainstem.  Clarity in 2006 was relatively lower than other years, with noticeable increases in 2007 and 2008.  In situ secchi observations for the Indian River Lagoon followed a clear latitudinal gradient with higher values in more southern segments (\cref{fig:light_irl}).  Very few measurements were available for the Upper Indian River Lagoon and Banana River segments, likely due to water clarity exceeding the maximum depth in shallow areas.

<<echo = F>>=
# load data
data(irl_light)
data(tb_light)
data(choc_light)
irl <- data.frame(irl_light)
tb <- data.frame(tb_light)
choc <- data.frame(choc_light)

# aov of zmax between bays
zcall <- reshape2::melt(
  list(tb = tb$z_c_all, irl = irl$z_c_all, choc = choc$z_c_all)
  )
zcall_means <- aggregate(value ~ L1, data = zcall, FUN = mean)
zcall_means <- split(zcall_means$value, zcall_means$L1)
zcall_aov <- summary(lm(value ~ L1, data = zcall))$fstatistic
zcall_aov <- c(zcall_aov, pf(zcall_aov[1], zcall_aov[2], zcall_aov[3],lower.tail=F))
names(zcall_aov) <- c('Fval', 'df1', 'df2', 'pval')
zcall_tuk <- aov(value ~ L1, data = zcall)
zcall_tuk <- TukeyHSD(zcall_tuk)

# aov between bays
light_btw <- reshape2::melt(
  list(tb = tb$light, irl = irl$light, choc = choc$light)
  )
light_btw_means <- aggregate(value ~ L1, data = light_btw, FUN = mean)
aov_btw <- summary(lm(value ~ L1, data = light_btw))$fstatistic
aov_btw <- c(aov_btw, pf(aov_btw[1], aov_btw[2], aov_btw[3],lower.tail=F))
names(aov_btw) <- c('Fval', 'df1', 'df2', 'pval')
tuk_btw <- aov(value ~ L1, data = light_btw)
tuk_btw <- TukeyHSD(tuk_btw)

# light within bays
wtn_tb <- summary(lm(light ~ seg, data = tb))$fstatistic
wtn_tb <- c(wtn_tb, pf(wtn_tb[1], wtn_tb[2], wtn_tb[3],lower.tail=F))
names(wtn_tb) <- c('Fval', 'df1', 'df2', 'pval')
wtn_irl <- summary(lm(light ~ seg, data = irl))$fstatistic
wtn_irl <- c(wtn_irl, pf(wtn_irl[1], wtn_irl[2], wtn_irl[3],lower.tail=F))
names(wtn_irl) <- c('Fval', 'df1', 'df2', 'pval')
wtn_choc <- summary(lm(light ~ seg, data = choc))$fstatistic
wtn_choc <- c(wtn_choc, pf(wtn_choc[1], wtn_choc[2], wtn_choc[3],lower.tail=F))
names(wtn_choc) <- c('Fval', 'df1', 'df2', 'pval')

# tukey comps
tuk_tb <- aov(light ~ seg, data = tb)
tuk_tb <- TukeyHSD(tuk_tb)$seg[, 'p adj']
# tuk_tb <- tuk_tb[tuk_tb < 0.05]
tuk_irl <- aov(light ~ seg, data = irl)
tuk_irl <- TukeyHSD(tuk_irl)$seg[, 'p adj']
# tuk_irl <- tuk_irl[tuk_irl < 0.05]
tuk_choc <- aov(light ~ seg, data = choc)
tuk_choc <- TukeyHSD(tuk_choc)$seg[, 'p adj']
# tuk_choc <- tuk_choc[tuk_choc < 0.05]
@

Seagrass \ac{doc} estimates were obtained for \Sexpr{nrow(choc_light)} locations in Choctawhatchee Bay, \Sexpr{nrow(tb_light)} locations in Tampa Bay, and \Sexpr{nrow(irl_light)} locations in the Indian River Lagoon (\Cref{tab:light_summ,fig:light_choc,fig:light_tb,fig:light_irl}).  Mean $Z_{c,\,max}$ for each bay was \Sexpr{zcall_means$choc}, \Sexpr{zcall_means$tb}, and \Sexpr{zcall_means$irl} m for Choctawhatchee Bay, Tampa Bay, and Indian River Lagoon, respectively, with all values being significantly different between bays (ANOVA, $F=$ \Sexpr{zcall_aov['Fval']}, $df =$ \Sexpr{zcall_aov['df1']}, \Sexpr{zcall_aov['df2']}, $p < 0.001$, followed by Tukey multiple comparison, $p<0.001$ for all).  Generally, spatial variation in $Z_{c,\,max}$ followed variation in light requirements for broad spatial scales with more seaward segments or areas near inlets having lower light requirements.  Mean light requirements were significantly different between all bays (ANOVA, $F=$ \Sexpr{aov_btw['Fval']}, $df =$ \Sexpr{aov_btw['df1']}, \Sexpr{aov_btw['df2']}, $p < 0.001$, Tukey $p<0.001$ for all), with a mean requirement of \Sexpr{mean(choc$light)}\% for Choctawhatchee Bay, \Sexpr{mean(tb$light)}\% for Tampa Bay, and \Sexpr{mean(irl$light)}\% for Indian River Lagoon.  Significant differences in light requirements between segments within each bay were also observed (ANOVA, $F =$ \Sexpr{form_fun(wtn_choc['Fval'], 1, 1, 1)}, $df =$ \Sexpr{wtn_choc['df1']}, \Sexpr{wtn_choc['df2']}, $p < 0.001$ for Choctawhatchee Bay, $F =$ \Sexpr{form_fun(wtn_tb['Fval'], 1, 1, 1)}, $df =$ \Sexpr{wtn_tb['df1']}, \Sexpr{wtn_tb['df2']}, $p < 0.001$ for Tampa Bay, $F =$ \Sexpr{form_fun(wtn_irl['Fval'], 1, 1, 1)}, $df =$ \Sexpr{wtn_irl['df1']}, \Sexpr{wtn_irl['df2']}, $p < 0.001$ for Indian River Lagoon).  Post-hoc evaluation of all pair-wise comparisons of mean light requirements between segments within each bay indicated that significant differences were apparent for several locations.  Significant differences were observed between all segments in Choctawhatchee Bay ($p<0.001$ for all), except the central and western segments (\cref{fig:light_choc}).  Similarly, significant differences in Tampa Bay were observed between all segments ($p<0.05$ for all), except Middle Tampa Bay and Old Tampa Bay (\cref{fig:light_tb}).  Finally, for the Indian River Lagoon, significant differences were observed only between the Lower Central Indian River Lagoon and the Upper ($p<0.001$) and Lower Mosquito Lagoons ($p = $ \Sexpr{form_fun(tuk_irl['LML-LCIRL'], 3, 3, 3)}),  the Lower Indian River Lagoon and the Upper ($p<0.001$) and Lower Mosquito Lagoons ($p =$ \Sexpr{form_fun(tuk_irl['LML-LIRL'], 3, 3, 3)}), and the Upper Central Indian River and the Upper Mosquito Lagoon ($p = $\Sexpr{form_fun(tuk_irl['UML-UCIRL'], 3, 3, 3)}) (\cref{fig:light_irl}).  Small sample sizes likely reduced the ability to distinguish between segments in the Indian River Lagoon.

\section{Discussion}

Seagrass depth of colonization is tightly coupled to variation in water quality such that an accurate method for estimating $Z_{c,\,max}$ provides a biologically-relevant description of aquatic habitat.  Accordingly, the ability to estimate seagrass depth of colonization and associated light requirements from relatively inexpensive sources of information has great value for developing an understanding of potentially limiting factors that affect ecosystem condition.  To these ends, this study presented an approach for estimating seagrass depth of colonization from existing geospatial datasets that has the potential to greatly improve clarity of description within multiple spatial contexts.  We evaluated four distinct coastal regions of Florida to illustrate utility of the method for describing seagrass depth limits at relatively small spatial scales and extended the analysis to entire bay systems by combining estimates with water clarity to characterize spatial variation in light requirements.  The results indicated that substantial variation in seagrass depth limits were observed, even within relatively small areas of interest.  Estimated light requirements also indicated substantial heterogeneity within and between entire bays, suggesting uneven distribution of factors that limit seagrass growth patterns.  To our knowledge, such an approach has yet to be implemented in widespread descriptions of aquatic habitat and there is great potential to expand the method beyond the current case studies.  The reproducible nature of the algorithm also enables a context-dependent approach given the high level of flexibility.

\subsection{Evaluation of the algorithm}

The algorithm for estimating seagrass depth of colonization has three primary advantages that facilitated a description of aquatic habitat in each of the case studies.  First, the application of non-linear least squares regression provided an empirical means to characterize the reduction of seagrass coverage with increasing depth.  This approach was necessary for estimating each of the three depth limits ($Z_{c,\,min}$, $Z_{c,\,med}$, $Z_{c,\,max}$) using the maximum slope of the curve.  The maximum rate of decline describes a direct and estimable physiological response of seagrass to decreasing light availability such that each measure provided an operational characterization of growth patterns (see \cref{sec:est_method}).  The regression approach also allowed an estimation of confidence in \ac{doc} values by accounting for uncertainty in each of the three parameters of the logistic growth curve ($\alpha$, $\beta$, $\gamma$). Indications of uncertainty are required components of any esimation technique that provide a direct evaluation of the quality of data used to determine he model fit.  By default, estimates with confidence intervals for $Z_{c,\,max}$ that included zero were discarded to remove highly imprecise estimates.  Despite this restriction, some examples had exceptionally large confidence intervals relative to neighboring estimates (e.g., center of Upper Indian River Lagoon, \cref{fig:all_ests}), which suggests not all locations are suitable for applying the algorithm. The ability to estimate \ac{doc} and to discriminate between the three measures depended on several factors, the most important being the extent to which the sampled seagrass points described a true reduction of seagrass coverage with depth.  Sampling method (e.g., chosen radius) as well as site-specific characteristics (e.g., bottom-slope, actual occurrence of seagrass) are critical factors that directly influence confidence in \ac{doc} estimates.  A pragmatic approach should be used when applying the algorithm to novel data such that the location and chosen sample radius should be defined by the limits of the analysis objectives. 

A second advantage is that the algorithm is highly flexible depending on the desired spatial context.  Although this attribute directly affects confidence intervals, the ability to choose a sampling radius based on a problem of interest can greatly improve the description of aquatic habitat given site-level characteristics.  The previous example described for the Big Bend region highlights this flexibility, such that a segment-wide estimate was inadequate for characterizing $Z_{c,\,max}$ that was limited near the outflow of the Steinhatchee river.  The ability to choose a smaller sampling radius more appropriate for the location indicated that $Z_{c,\,max}$ reflected known differences in water clarity near the outflow relative to other locations in the segment.  However, an important point is that a segment-wide estimate is not necesarily biased such that a sampling radius that covers a broad spatial area could be appropriate depending on the analysis needs.  If the effect of water clarity near the outflow was not a concern, the segment-wide estimate could describe seagrass growth patterns for the larger area without inducing descriptive bias.  However, water quality standards as employed by management agencies are commonly based on predefined management units, which may not be appropriate for all locations.  The flexibility of the algorithm could facilitate the development of point-based standards that eliminate the need to develop or use a pre-defined classification scheme.  In essence, the relevant management area can be defined a priori based on known site characteristics.

The ability to use existing geospatial datasets is a third advantage of the algorithm.  Further, bathymetry data and seagrass coverage are the only requirements for describing $Z_c$ in a spatial context.  These datasets are routinely collected by agencies at annual or semi-annual cycles for numerous coastal regions.  Accordingly, data availability and the relatively simple method for estimating \ac{doc} suggests that spatial descriptions could be developed for much larger regions with minimal effort.  The availability of satellite-based products with resolutions appropriate for the scale of assessment could also facilitate a broader understanding of seagrass light requirements when combined with \ac{doc} estimates.  However, data quality is always a relevant issue when using secondary information as a means of decision-making or addressing specific research questions.  Methods for acquiring bathymetric or seagrass coverage data are generally similar between agencies such that the validity of comparisons from multiple sources is typically not a concern.  However, one point of concern is the minimum mapping unit for each coverage layer, which is limited by the resolution of the original aerial photos and the comparability of photo-interpreted products created by different analysts.  Seagrass maps routinely classify coverage as absent, patchy, or continuous.  Discrepancies between the latter two categories between regions limited the analysis to a simple binary categorization of seagrass as present or absent. An additional evaluation of comparability between categories for different coverage maps could improve the descriptive capabilities of \ac{doc} estimates.

\subsection{Heterogeneity in growth patterns and light requirements}

Variation in $Z_c$ for each of the case studies, as individual segments and whole bays, was typically most pronounced along mainstem axes of each estuary or as distance from an inlet.  Greater depth of colonization was observed near seaward locations and was also most limited near river inflows.  Although an obvious conclusion would be that depth of colonization is correlated with bottom depth, i.e., seagrasses grow deeper because they can, a more biologically-relevant conclusion is that seagrass depth of colonization follows expected spatial variation in water clarity.  Shallow areas within an estuary are often near river outflows where discharge is characterized by high sediment or nutrient loads that contribute to light scattering and increased attenuation.  Variation in \ac{doc} along mainstem axes was not unexpected, although the ability to characterize within-segment variation for each of the case studies was greatly improved from more coarse estimates.  Seagrasses may also be limited in shallow areas by tidal stress such that a minimum depth can be defined that describes the upper limit related to dessication stress from exposure at low tide.  Coastal regions of Florida, particularly the Gulf Coast, are microtidal with amplitudes not exceeding 0.5 meters.  Accordingly, the effects of tidal stress on limiting the minimum depth of colonization were not apparent for many locations in the case studies such that $Z_{c,\,min}$ estimates were often observed at zero depth.  Although this measure operationally defines the depth at which seagrasses begin to decline with decreasing light availability, $Z_{c,\,min}$ could also be used to describe the presence or absence of tidal stress.

The use of light attenuation data, either as satellite-derived estimates or in situ secchi observations, combined with \ac{doc} estimates provided detailed and previously unavailable characterizations of light requirements within the three estuaries.  Requirements were lowest for the Indian River Lagoon, whereas estimates were higher for Tampa Bay and highest for Choctawhatchee Bay. Requirements for the Indian River Lagoon were generally in agreement with other Atlantic coastal systems \citep{Dennison93,Kemp04}, such that requirements typically did not exceed 25\% with mean requirements for whole bay estimated at \Sexpr{mean(irl$light)}\%.  However, light requirements for Indian River Lagoon were based on secchi observations with uneven spatial and temporal coverage, which potentially led to an incomplete description of true variation in light attenuation.  Alternative measures to estimate $K_d$ (e.g., vertically-distributed PAR sensors) are required when bottom depth is shallower than maximum water clarity, although scalability remains an issue.  Conversely, satellite-derived estimates were possible for Tampa and Choctawhatchee Bays where water column depth was sufficient and were preferred over in situ data given more complete spatial coverage. Mean light requirements for Tampa Bay were \Sexpr{mean(tb$light)}\% of surface irradiance, which was in agreement with previously reported values, particularly for Lower Tampa Bay \citep{Dixon95}.  Estimates for Choctawhatchee Bay were substantially higher with a bay-wide average of \Sexpr{mean(choc$light)}\%.  The relatively higher light requirements for Gulf Coast esuaries, particularly Choctawhatchee Bay, may reflect the need for additional validation data for the conversion of satellite reflectance values to light attenuation.  However, estuaries in the northern Gulf of Mexico are typically shallow and highly productive \citep{Caffrey14}, such that high light requirements may in fact be related to the effects of high nutrient loads on water clarity.  Further evaluation of seagrass light requirements in the northern Gulf of Mexico could clarify the extent to which our results reflect true differences relative to other coastal regions.

As previously noted, variation in seagrass light requirements can be attributed to differences in physiological requirements between species or regional effects of different light regimes \citep{Choice14}.  For example, \textit{Halodule wrightii} is the most abundant seagrass in Choctawhatchee Bay and occurs in the western polyhaline portion near the outflow with the Gulf of Mexico.  Isolated patches of \textit{Ruppia maritima} are also observed in the oligohaline eastern regions of the bay. Although $Z_{c,\,max}$ was only estimable for a few points in eastern Choctawhatchee Bay, differences in species assemblages along a salinity gradient likely explain the differences in light requirements. The decline of \textit{R. maritima} in eastern Choctawhatchee Bay has been attributed to species sensitivity to turbidity from high rainfall events, whereas losses of \textit{H. wrightii} have primarily been attributed to physical stress during storm overwash and high wave energy \citepalias{FLDEP12}.  The relatively high light requirements of eastern Choctawhatchee Bay likely reflect differing species sensitivity to turbidity, either through sediment resuspension from rainfall events or light attenuation from nutrient-induced phytoplankton production.  Similarly, high light requirements may be related to epiphyte production at the leaf surface \citep{Kemp04}.  Estimated light requirements based solely on water column light attenuation, as for secchi or satellite-derived values, may indicate unusually large light requirements if seagrasses are further limited by epiphytic growth at the leaf surface.  Epiphyte limitation may be common for upper bay segments where nutrient inputs from freshwater inflows enhance algal production \citep{Kemp04}.  Additionally, lower light requirements for Hillsborough Bay relative to Old Tampa Bay may reflect a reduction in epiphyte load from long-term decreases in nitrogen inputs to northeast Tampa Bay \citep{Dawes10}.

\subsection{Conclusions}

Spatially-resolved estimates of \ac{doc} combined with high-resolution measures of light attenuation provided an effective approach for evaluating light requirements. However, light requirements, although important, may only partially describe ecosystem characteristics that influence growth patterns.  Seagrasses may be limited by additional physical, geological, or geochemical factors, including effects of current velocity, wave action, sediment grain size distribution, and sediment organic content \citep{Koch01}.  Accordingly, spatially-resolved estimates of \ac{doc} and associated light requirements must be evaluated in the context of multiple factors that may act individally or interactively with light attenuation.  Extreme estimates of light requirements may suggest light attenuation is not the only determining factor for seagrass growth.  An additional constraint is the quality of data that describe water clarity to estimate light requirements.  Although the analysis used satellite-derived clarity to create a more complete description relative to in situ data, the conversion of reflectance data from remote sensing products to attenuation estimates is not trivial.  Further evaluation of satellite-derived data is needed to create a broader characterization of light requirements.  However, the algorithm was primarily developed to describe maximum depth of colonization and the estimation of light requirements was a secondary product that illustrated an application of the method.  Spatially-resolved \ac{doc} estimates can be a preliminary source of information for developing a more detailed characterization of seagrass habitat requirements and the potential to develop broad-scale descriptions has been facilitated as a result.  Specifically, \citetalias{HagyIR} developed a more general approach for estimating \ac{doc} for each coastal segment of Florida such that data are available to apply the current method on a much broader scale.  Applications outside of Florida are also possible given the minimal requirements for geospatial data products to estimate depth of colonization.  

%%%%%%
% refs
\clearpage
\begin{singlespace}
\bibliographystyle{apalike_mine}
\bibliography{ref_sgdepth}
\end{singlespace}
\clearpage

%%%%%%
% tables

% summary of wbid characteristics
<<eval = T, echo = F>>=

# # create shapefile object of seagrass coverages
# id <- c('sg_2007_303.shp', 'sg_2006_820.shp', 'sg_2010_902.shp', 'sg_2009_1502.shp')
# sg_shps <- list()
# for(i in id){
#   
#   path <- paste0('M:/GIS/seagrass/', i)
#   sg <- readShapeSpatial(path)
#   sg_shps[[i]] <- sg
#   
# }
# save(sg_shps, file = 'data/sg_shps.RData')
# 
# # bathymetry data
# id <- c('dep_303.shp', 'dep_820.shp', 'dep_902.shp', 'dep_1502.shp')
# dep_shps <- list()
# for(i in id){
#   
#   cat(i, '\n')
#   path <- paste0('M:/GIS/seagrass/', i)
#   dep <- readShapeSpatial(path)
#   dep_shps[[i]] <- dep
#   
# }
# save(dep_shps, file = 'data/dep_shps.RData')
# 
# load(file = 'data/shps.RData')
# load(file = 'data/sg_shps.RData')
# load(file = 'data/secc_all.RData')
# load(file = 'data/dep_shps.RData')
# 
# nm <- c('W. Choctawhatchee Bay', 'Big Bend', 'Old Tampa Bay', 'Upper Indian River Lagoon')
# 
# # lat, long
# lat <- sapply(
#   c('seg_303.shp', 'seg_820.shp', 'seg_902.shp', 'seg_1502.shp'), 
#   function(x) data.frame(rgeos::gCentroid(shps[[x]]))[, 2]
# )
# lon <- sapply(
#   c('seg_303.shp', 'seg_820.shp', 'seg_902.shp', 'seg_1502.shp'), 
#   function(x) data.frame(rgeos::gCentroid(shps[[x]]))[, 1]
# )
# 
# # segment, seagrass, prop areas
# areas <- sapply(
#   c('303', '820', '902', '1502'), 
#   function(x){
#     
#     # data and projections
#     seg <- shps[[paste0('seg_', x, '.shp')]]
#     sg <- sg_shps[[grep(paste0(x, '\\.shp'), names(sg_shps))]]
#     proj4string(seg) <- CRS("+proj=longlat +datum=NAD83")
#     proj4string(sg) <- CRS("+proj=longlat +datum=NAD83")
#     
#     # proj for transformation
#     trans_proj <- CRS("+proj=utm +zone=17 +datum=NAD83")
#     if(x == '303') trans_proj <- CRS("+proj=utm +zone=16 +datum=NAD83")
#     seg <- spTransform(seg, trans_proj)  
#     sg <- spTransform(sg, trans_proj)
#     
#     # clip, get area in sq km
#     clip_sg <- gIntersection(sg, seg, byid = TRUE) #, drop_lower_td = TRUE)
#     seg_est <- gArea(seg)/1e6
#     sg_est <- gArea(clip_sg)/1e6
#     
#     # list output
#     c(seg_est, sg_est)
#       
#   })
# 
# # segment depths
# deps <- sapply(
#   c('303', '820', '902', '1502'), 
#   function(x){
#     
#     tmp <- dep_shps[[paste0('dep_', x, '.shp')]]
#     nm <- c('depth', 'GRID_CODE', 'Depth')
#     nm <- names(tmp)[names(tmp) %in% nm]
#     tmp <- -1 * data.frame(tmp)[, nm, drop = T]
#     
#     tmp <- tmp[tmp <= quantile(tmp, 0.99)]
#     mn_val <- mean(tmp, na.rm = T)
#     max_val <- max(tmp, na.rm = T)
#   
#     c(mn_val, max_val)
#     
#   })
# 
# # segment secchi
# seccs <- sapply(
#   c('303', '820', '902', '1502'), 
#   function(x){
#     
#     # subset secchi
#     seg <- shps[[paste0('seg_', x, '.shp')]]
#     secc <- !is.na(secc_all %over% seg)[, 1]
#     secc <- secc_all[secc, ]
#     secc$yr <- as.numeric(strftime(secc$Date, '%Y'))
#     
#     # subset by most recent ten years
#     yr_vals <- data.frame(
#       seg = c('303', '820', '902', '1502'), 
#       yrs = c(2007, 2006, 2010, 2009)
#       )
#     yr <- yr_vals[yr_vals$seg == x, 'yrs']
#     secc <- secc[secc$yr > yr - 10 & secc$yr <= yr, ]
#     
#     # mean secchi and n
#     ave_secc <- mean(as.numeric(secc$SD), na.rm = T)
#     se_secc <- sd(as.numeric(secc$SD), na.rm = T)/sqrt(length(na.omit(secc$SD)))
#       
#     c(ave_secc, se_secc)
#     
#   })
# # fill in 820 manually, data are from elsewhere
# seccs[, 2] <- c(1.34, 0.19)
# 
# # combine data
# out <- data.frame(rbind(lat, lon, areas, deps, seccs), stringsAsFactors = F)
# names(out) <- nm
# row.names(out) <- c('Latitude', 'Longitude', 'Surface area', 'Seagrass area', 'Depth (mean)', 'Depth (max)', 'Secchi (mean)', 'Secchi (se)')
#   
# seg_summ <- out
# save(seg_summ, file = 'data/seg_summ.RData')

load(file = 'data/seg_summ.RData')

# rearrange col orders for alphabetical
names(seg_summ) <- c('WCB', 'BB', 'OTB', 'UIRL')
seg_summ <- seg_summ[, order(names(seg_summ))]

# prep table
tab <- seg_summ
nms <- names(tab)
tab <- data.frame(apply(tab, 2, form_fun), stringsAsFactors = F)
tab<- rbind(year = c('2006', '2010', '2009', '2007'), tab)
names(tab) <- nms
rows <- c('Year\\textsuperscript{\\textit{b}}', 'Latitude', 'Longitude', 'Surface area', 'Seagrass area', 'Depth (mean)', 'Depth (max)', 'Secchi (mean)', 'Secchi (se)')

# shorten names
names(tab) <- gsub('BB', 'BB\\\\textsuperscript{\\\\textit{a}}', names(tab))

cap.val <- "Characteristics of coastal segments used to evaluate seagrass \\acl{doc} estimates (see \\cref{fig:seg_all} for spatial distribution).  Year is the date of the seagrass coverage and bathymetric data.  Latitude and longitude are the geographic centers of each segment.  Area and depth values are meters and square kilometers, respectively.  Secchi measurements (m) were obtained from the Florida Department of Environmental Protection's \\acl{IWR} (\\acs{IWR}) database, update number 40.  Secchi mean and standard errors are based on all observations within the ten years preceding each seagrass survey."

foot.val <- '\\footnotesize \\textsuperscript{\\textit{a}} BB: Big Bend, OTB: Old Tampa Bay, UIRL: Upper Indian R. Lagoon, WCB: Western Choctawhatchee Bay\\\\\\textsuperscript{\\textit{b}} Seagrass coverage data sources, see \\cref{sec:data_srcs} for bathymetry data sources:\\scriptsize\\\\BB: \\url{http://atoll.floridamarine.org/Data/metadata/SDE_Current/seagrass_bigbend_2006_poly.htm}\\\\OTB: \\url{http://www.swfwmd.state.fl.us/data/gis/layer_library/category/swim}\\\\UIRL: \\url{http://www.sjrwmd.com/gisdevelopment/docs/themes.html}\\\\WCB \\url{http://atoll.floridamarine.org/data/metadata/SDE_Current/seagrass_chotawhatchee_2007_poly.htm}'

latex( 
  tab,
  file = '',
  rowlabel = '',
  caption = cap.val,
  caption.loc = 'top',
  insert.bottom = foot.val, 
  rowname = rows,
  label = 'tab:seg_summ'
  )

@

% comparisons with segment wide ests
<<eval = T, echo = F>>=

# ##
# # get doc ests for whole seg
# 
# load('data/shps.RData')
# 
# segs <- c('303', '820', '902', '1502')
# 
# ests_seg <- vector('list', length = length(segs))
# names(ests_seg) <- segs
# 
# for(seg in segs){
#     
#   seg_shp <- shps[[paste0('seg_', gsub('^.*_', '', seg), '.shp')]]
#   sgpts_shp <- shps[[grep(paste0('^sgpts.*', seg, '.shp$'), names(shps))]]
#   
#   rad <- 0.25 # sufficient for each seg
#   test_loc <- rgeos::gCentroid(seg_shp)
#   ests <- doc_est_grd(test_loc, sgpts_shp, radius = rad)
# 
#   ests_seg[[seg]] <- data.frame(ests, seg = seg)
#   
# }
# 
# ests_seg <- do.call('rbind', ests_seg)
# names(ests_seg)[names(ests_seg) %in% c('x', 'y')] <- c('long', 'lat')
# 
# save(ests_seg, file = 'data/ests_seg.RData')
# 
# # get estimates for grids
# ests_out <- vector('list', length = length(segs))
# names(ests_out) <- segs
# 
# for(seg in segs){
#     
#   seg_shp <- shps[[paste0('seg_', gsub('^.*_', '', seg), '.shp')]]
#   sgpts_shp <- shps[[grep(paste0('^sgpts.*', seg, '.shp$'), names(shps))]]
#   
#   grid_spc <- 0.01
#   rad <- 0.02
#   grid_seed <- 4321
#   set.seed(grid_seed)
#   pts <- grid_est(seg_shp, spacing = grid_spc) 
#   ests <- doc_est_grd(pts, sgpts_shp, radius = rad, out_sens = T, remzero = F)
# 
#   ests_out[[seg]] <- data.frame(ests, seg = seg)
#   
# }
# 
# ests_out <- do.call('rbind', ests_out)
# names(ests_out)[names(ests_out) %in% c('Var1', 'Var2')] <- c('long', 'lat')
# 
# # get ci size, these are all the same for each measure
# # get lower bound of z_cmax for eval of those greater than zero
# ests_out$confint <- with(ests_out, h_z_cmin - l_z_cmin)
# ests_out$lower_max <- ests_out$l_z_cmax
# ests_out <- ests_out[, !grepl('^h_|^l_', names(ests_out))]
# 
# # remove outliers from ests based on 99%
# ests <- ests_out[, c('z_cmin', 'z_cmed', 'z_cmax')]
# filt_val <- quantile(unlist(c(ests)), 0.99)
# ests[ests > filt_val] <- NA
# ests_out[, c('z_cmin', 'z_cmed', 'z_cmax')] <- ests
# ests_out <- na.omit(ests_out)
# 
# ests_out_nonsigs <- ests_out
# ests_out <- ests_out[ests_out$lower_max >= 0, ]
# 
# # remove outliers for bb and tb
# ests_out <- ests_out[!row.names(ests_out) %in% c('820.159', '1502.82'), ]
# 
# save(ests_out_nonsigs, file = 'data/ests_out_nonsigs.RData')
# save(ests_out, file = 'data/ests_out.RData')

# load data
load(file = 'data/ests_seg.RData')
load(file = 'data/ests_out.RData')

# rearrange row orders for alphabetical
segs <- c('WCB', 'BB', 'OTB', 'UIRL')
levels(ests_seg$seg) <- segs
ests_seg$seg <- as.character(ests_seg$seg)
ests_seg <- ests_seg[order(ests_seg$seg), ]
levels(ests_out$seg) <- segs
ests_out$seg <- as.character(ests_out$seg)
ests_out <- ests_out[order(ests_out$seg), ]
segs <- sort(segs)

# summarize spatail ests
ests_out <- melt(ests_out, measure.var = c('z_cmin', 'z_cmed', 'z_cmax'))
ests_out <- ddply(ests_out, .variable = c('seg', 'variable'),   
  .fun = function(x) {
    c(mean_val = mean(x$value),
    sd_val = sd(x$value),
    min_val = min(x$value),
    max_val = max(x$value)
    )
  })

# merge with segment wide ests
ests_seg <- melt(ests_seg, measure.var = c('z_cmin', 'z_cmed', 'z_cmax'))
to_tab <- merge(ests_seg[, c('seg', 'variable', 'value')], ests_out, by = c('seg', 'variable'))
to_tab$variable <- factor(to_tab$variable, levels = c('z_cmin', 'z_cmed', 'z_cmax'))
to_tab <- to_tab[order(to_tab$seg, to_tab$variable), ]
names(to_tab) <- c('Segment', 'Estimate', 'Whole segment', 'Mean', 'St. Dev.', 'Min', 'Max')

# prep table
estimate <- to_tab$Estimate
estimate <- factor(estimate, levels = c('z_cmin', 'z_cmed', 'z_cmax'), 
  labels = c('$Z_{c,\\,min}$', '$Z_{c,\\,med}$', '$Z_{c,\\,max}$'))
nms <- names(to_tab)[-c(1, 2)]
tab <- to_tab[, !names(to_tab) %in% c('Segment', 'Estimate')]

tab <- data.frame(apply(tab, 2, form_fun), stringsAsFactors = F)
names(tab) <- nms

foot.val<-'\\textsuperscript{\\textit{a}}\\footnotesize BB: Big Bend, OTB: Old Tampa Bay, UIRL: Upper Indian River Lagoon, WCB: Western Choctawhatchee Bay.' 

cap.val <- "Summary of seagrass depth estimates (m) for each segment using all grid locations in \\cref{fig:all_ests}.  Whole segment estimates were obtained from all seagrass depth data for each segment."

latex(
  tab,
  file = '',
  rowlabel = '{\\bf Segment\\textsuperscript{\\textit{a}}}',
  caption = cap.val,
  dcolumn = T,
  caption.loc = 'top',
  rgroup = segs,
  n.rgroup = rep(3,4),
  insert.bottom = foot.val,
  rowname = estimate,
  label = 'tab:est_summ'
  )

@

% summary of sensitivity analysis
<<eval = T, echo = F>>=

# load data
data(shps)
data(ests_out)

# summarize 
to_tab <- group_by(ests_out, seg) %>% 
  summarize(
    `Mean` = mean(confint),
    `St. Dev` = sd(confint), 
    `Min` = min(confint), 
    `Max` = max(confint)
    )

# prep table
segs <- c('WCB', 'BB', 'OTB', 'UIRL')
tab <- select(to_tab, -seg)
nms <- names(tab)
tab <- data.frame(apply(tab, 2, form_fun), stringsAsFactors = F)
names(tab) <- nms

cap.val <- "Summary of uncertainty for seagrass depth estimates (m) for each segment using all grid locations in \\cref{fig:all_ests}.  Summaries are based on the widths of 95\\% confidence intervals.  The uncertainty values are equally applicable to each seagrass depth measure ($Z_{c,\\,min}$, $Z_{c,\\,med}$, $Z_{c,\\,max}$)."

foot.val<-'\\textsuperscript{\\textit{a}}\\footnotesize BB: Big Bend, OTB: Old Tampa Bay, UIRL: Upper Indian River Lagoon, WCB: Choctawhatchee Bay.' 

col_heads <- c('Min year', 'Max year', '$n_{Secchi}$', '$n_{Z}$', 'Secchi', '$Z_{c,\\,max}$', '\\% light')

# rearrange row orders for alphabetical
arr <- order(segs)
segs <- segs[arr]
tab <- tab[arr, ]

# output
latex(
  tab,
  file = '',
  rowlabel = 'Segment\\textsuperscript{\\textit{a}}',
  caption = cap.val,
  dcolumn = T,
  caption.loc = 'top',
  rowname = segs,
  insert.bottom = foot.val,
  label = 'tab:sens_summ'
  )

@

% summary of light requirements analysis, max depth ests
<<eval = T, echo = F>>=

# ##
# # load data
# 
# # load results from figure chunks
# data(tb_light)
# data(irl_light)
# data(choc_light)
# 
# ##
# # prep data
# 
# # add bay column, select relevant columns
# choc_light <- mutate(choc_light, bay = 'Choctawhatchee Bay') %>% 
#   select(bay, seg, z_c_all, light)
# irl_light <- mutate(irl_light, bay = 'Indian River Lagoon')%>% 
#   select(bay, seg, z_c_all, light)
# tb_light <- mutate(tb_light, bay = 'Tampa Bay')%>% 
#   select(bay, seg, z_c_all, light)
# 
# # summarize
# all_light <- rbind(choc_light, irl_light, tb_light) %>% 
#   group_by(bay, seg) %>% 
#   summarize(
#     n_locs = length(seg), 
#     mean_z_cmax = mean(z_c_all), 
#     sd_z_cmax = sd(z_c_all),
#     min_z_cmax = min(z_c_all),
#     max_z_cmax = max(z_c_all),
#     mean_light = mean(light),
#     sd_light = sd(light),
#     min_light = min(light),
#     max_light = max(light)
#     )
# 
# save(all_light, file = 'data/all_light.RData')

# load data
data(all_light)

# prep for table
tab <- data.frame(all_light)
# tab <- tab[, !grepl('_light$', names(tab))]
rows <- tab[, 2]
tab <- tab[, -c(1:2)]
tab[, 2:9] <- formtab_fun(tab[, 2:9], 1, 1, 1)
nms <- names(tab) # this is fucked
ncoltab <- ncol(tab)
nrowtab <- nrow(tab)
tab <- unlist(tab)
tab[grepl('NaN$', tab)] <-  ' '
tab <- matrix(tab, nrow = nrowtab, ncol = ncoltab)
tab <- data.frame(tab)
names(tab) <- nms

cap.val<-'Summary of maximum depth of colonization ($Z_{c,\\,max}$, m) and light requirements (\\%) for all bay segments of Choctawhatchee Bay, Indian River Lagoon, and Tampa Bay.  See \\cref{fig:light_choc,fig:light_tb,fig:light_irl} for spatial distribution of the results.'

foot.val<-'\\textsuperscript{\\textit{a}}\\footnotesize CCB: Central Choctawhatchee Bay, ECB: Eastern Choctawhatchee Bay, WCB: Western Choctawhatchee Bay, BR: Banana R., LCIRL: Lower Central Indian R. Lagoon, LIRL: Lower Indian R. Lagoon, LML: Lower Mosquito Lagoon, UCIRL: Upper Central Indian R. Lagoon, UIRL: Upper Indian R. Lagoon, UML: Upper Mosquito Lagoon, HB: Hillsborough Bay, LTB: Lower Tampa Bay, MTB: Middle Tampa Bay, OTB: Old Tampa Bay.' 
col_heads <- c('$n$', rep(c('Mean', 'St. Dev.', 'Min', 'Max'), 2))

latex( 
  tab,
  file = '',
  rowlabel = 'Segment\\textsuperscript{\\textit{a}}',
  rgroup = c('Choctawhatchee Bay', 'Indian River Lagoon', 'Tampa Bay'), 
  n.rgroup = c(3, 7, 4),
  insert.bottom = foot.val,
  caption = cap.val,
  colheads = col_heads,
  cgroup = c('', '{\\bf $Z_{c,\\,max}$}', '\\% light'), 
  n.cgroup = c(1, 4, 4),
  caption.loc = 'top',
  rowname = rows,
  size = 'small', 
  label = 'tab:light_summ'
  )

@

\clearpage

%%%%%%
% figures

% example of buffer points for depth of col
<<buff_ex, cache = T, fig = F, echo = F, eval = T, message = F, results = 'hide', include = F>>=
########

# reset digits
options(digits = 4)

# load data, buff_ex_dat was created from various shapefiles
data(buff_ex_dat)
seg <- buff_ex_dat[['seg']] # 820 segment polygon
state <- buff_ex_dat[['state']] # florida state polygon
sgpoly <- buff_ex_dat[['sgpoly']] # 820 segment seagrass polygon
sgrass <- buff_ex_dat[['sgrass']] # 820 segment seagrass depth point
depths <- buff_ex_dat[['depths']] # 820 segment bathymetry dem, for contour lines
rm('buff_ex_dat')

# get a subsample of seagrass depth points for plotting
set.seed(4321)

est_pts <- grid_est(seg, spacing = 0.02)
sgrass <- sgrass[sample(1:length(sgrass), 1000), ]
test_pt <- est_pts[27, ]
buff_pts <- buff_ext(sgrass, test_pt, buff = 0.02)

# format buff_pts and sgrass for plotting
buff_pts <- data.frame(buff_pts)
levels(buff_pts$Seagrass) <- c('Seagrass present', 'Seagrass present', 'Seagrass absent')
buff_pts$Seagrass <- as.character(buff_pts$Seagrass)
sgrass <- data.frame(sgrass)
levels(sgrass$Seagrass) <- c('Seagrass present', 'Seagrass present', 'Seagrass absent')
sgrass$Seagrass <- as.character(sgrass$Seagrass)

# segment wide est for zcmax (all cats) for 820 from Hagy is 3.855
# get contour lines from bathymetry layer, one for whole segment and one for limit
to_cont <- seq(1, 15, by = 2)
im <- as.image.SpatialGridDataFrame(depths)
conts <- contourLines(im, levels = -1 * to_cont)
conts <- ContourLines2SLDF(conts)
zc_conts <- contourLines(im, levels = -3.855)
zc_conts <- ContourLines2SLDF(zc_conts)

# seagrass and depth contours
p1 <- ggplot(state, aes(long, lat, group = group)) + 
  geom_polygon(fill = 'lightgrey') +
  geom_polygon(data = seg, fill = 'white', col = 'black', aes(size = 'Segment polygon')) + 
  geom_polygon(data = sgpoly, aes(group = group, fill = 'Seagrass coverage'), 
    alpha = 0.7) + 
  geom_polygon(data = state, aes(group = group), 
    fill = 'grey') + 
  geom_path(data = conts, 
    aes(group = group, linetype = 'dashed')
    ) + 
  geom_path(data = zc_conts, 
    aes(group = group, colour = 'Estimated depth\nlimit for segment'), 
    size = 2
    ) +
  scale_fill_manual(values = 'royalblue') + 
  scale_colour_manual(
    values = 'red'
    ) +
  scale_size_manual('', values = 2) +
  scale_linetype_manual(labels = '2 m depth contours', values = 'dashed') +
  theme_classic() +
  coord_equal() +
  xlab('Longitude') +
  ylab('Latitude') +
  coord_map(
    xlim = c(-83.65, -83.35),
    ylim = c(29.4, 29.8)
  ) +
  theme(axis.text = element_text(size = 10),
    axis.title = element_text(size = 20), 
    legend.text = element_text(size = 20),
    legend.title = element_blank()
  ) + 
  guides(fill = guide_legend(order = 1), 
    linetype = guide_legend(order = 2), 
    colour = guide_legend(order = 3)
  )

p1leg <- g_legend(p1)
p1 <- p1 + theme(legend.position = 'none')

p2 <- ggplot(seg, aes(long, lat)) + 
  geom_polygon(fill = 'white') +
  geom_path(color = 'black', size = 2) +
  geom_polygon(data = state, aes(group = group), fill = 'lightgrey') + 
  xlab('Longitude') +
  ylab('Latitude') +
  geom_point(
    data = data.frame(sgrass), 
    aes(x = coords_x1, y = coords_x2, shape = Seagrass), col = 'royalblue'
    ) +
  geom_point(
    data = data.frame(est_pts), 
    aes(Var1, Var2), size = 3, pch = 21, col = 'black', bg = 'white'
  ) +  
  geom_point(
    data = data.frame(est_pts), 
    aes(Var1, Var2), size = 17, pch = 1, colour = 'grey60'
  ) +
  scale_shape_manual('', values = c(2, 16)) +
  coord_equal() +
  coord_map(
    xlim = c(-83.65, -83.35),
    ylim = c(29.4, 29.8)
    ) + 
  theme_classic() +
  theme(axis.text = element_text(size = 10),
    legend.text = element_text(size = 20),
    axis.title = element_text(size = 20)
    )

p2leg <- g_legend(p2)
p2 <- p2 + theme(legend.position = 'none')

p3 <- ggplot(seg, aes(long, lat)) + 
  geom_polygon(fill = 'white') +
  geom_path(color = 'black', size = 2) +
  geom_polygon(data = state, aes(group = group), fill = 'lightgrey') +
  theme_classic() +
  coord_equal() +
  xlab('Longitude') +
  ylab('Latitude') +
  coord_map(
    xlim = c(-83.65, -83.35),
    ylim = c(29.4, 29.8)
    ) +
  geom_point(
    data = buff_pts,
    aes(coords.x1, coords.x2, pch = Seagrass), 
    colour = 'royalblue'
  ) + 
  geom_point(
    data = data.frame(est_pts), 
    aes(Var1, Var2), colour = 'black', bg = 'white', size = 3, pch = 21
  ) +
  geom_point(
    data = data.frame(test_pt),
    aes(Var1, Var2), colour = 'red', size = 5, pch = 16
  ) +
  geom_point(
    data = data.frame(test_pt),
    aes(Var1, Var2), size = 17, pch = 1, colour = 'grey60'
  ) +
  scale_shape_manual('', values = c(2, 16)) +
  theme(axis.text = element_text(size = 10),
    legend.text = element_text(size = 20), 
    axis.title = element_text(size = 20), 
    legend.position = 'none')

pleg <- ggplot(seg, aes(long, lat)) + 
  geom_polygon(fill = 'white') +
  geom_path(color = 'black') +
  theme_classic() +
  coord_equal() +
  xlab('Longitude') +
  ylab('Latitude') +
  scale_x_continuous(limits = c(-83.65, -83.35)) +
  scale_y_continuous(limits = c(29.4, 29.8)) +
  geom_point(
    data = data.frame(est_pts), 
    aes(Var1, Var2, colour = 'grid', size = 'grid', pch = 'grid'),
  ) +
  geom_point(
    data = data.frame(test_pt),
    aes(Var1, Var2, colour = 'test', size = 'test', pch = 'test'),
  ) +
  geom_point(
    data = data.frame(est_pts), 
    aes(Var1, Var2, size = 'rad', pch = 'rad', colour = 'rad'),
  )  +
  scale_colour_manual('', labels = c('Estimation grid', 'Test point', 'Sample area'), values = c('black', 'red', 'grey60')) +
  scale_size_manual('', labels = c('Estimation grid', 'Test point', 'Sample area'), values = c(3, 4, 10)) +
  scale_shape_manual('', labels = c('Estimation grid', 'Test point', 'Sample area'), values = c(1, 16, 1)) +
theme(axis.text = element_text(size = 20),
  legend.text = element_text(size = 20),
  axis.title = element_text(size = 20)
  )

pleg <- g_legend(pleg)

pdf('figs/buff_ex.pdf', height = 6, width = 6, family = 'serif')
p1
p2
p3
grid.arrange(p1leg, p2leg, pleg, heights = c(1, 0.6, 0.6), ncol = 1)
dev.off()
   
options(digits = 2)
@

% example of buffer points for depth of col
\begin{figure}
\centering
\subfloat[][Seagrass coverage and bathymetry for the segment]{
\includegraphics[width=0.5\textwidth,page=1]{figs/buff_ex.pdf}
\label{fig:buff_ex1}
}
\subfloat[][Grid of locations and sample areas for estimates]{
\includegraphics[width=0.5\textwidth,page=2]{figs/buff_ex.pdf}
\label{fig:buff_ex2}
}

\subfloat[][Sampled seagrass data for a test point]{
\includegraphics[width=0.5\textwidth,page=3]{figs/buff_ex.pdf}
\label{fig:buff_ex3}
}
\subfloat{
\includegraphics[width=0.5\textwidth,page=4]{figs/buff_ex.pdf}
}
\caption{Examples of data and grid locations for estimating seagrass depth of colonization for a region of the Big Bend, Florida.  \Cref{fig:buff_ex1} shows the seagrass coverage and depth contours at 2 meter intervals, including the whole segment estimate for depth of colonization. \cref{fig:buff_ex2} shows a grid of sampling locations with sampling radii for estimating \ac{doc} and seagrass depth points derived from bathymetry and seagrass coverage layers.  \cref{fig:buff_ex3} shows an example of sampled seagrass depth points for a test location.  Estimates in \cref{fig:est_ex} were obtained from the test location in \cref{fig:buff_ex3}.}
\label{fig:buff_ex}
\end{figure}

% example of depth of col ests for wbid - big bend 820
\begin{figure}
\centerline{\includegraphics[width = \textwidth]{figs/seg_all.pdf}}
\caption{Locations and seagrass coverage of estuary segments used to evaluate \acl{doc} estimates.  Seagrass coverage layers are from 2006 (BB: Big Bend), 2010 (OTB: Old Tampa Bay), 2009 (UIRL: Upper Indian R. Lagoon), and 2007 (WCB: Western Choctawhatchee Bay).}
\label{fig:seg_all}
\end{figure}

% example of estimating seagrass depth of colonization
<<est_ex, cache = T, echo = F, results = 'hide', eval = T>>=

data(shps)

seg <- shps[['seg_820.shp']] # 820 segment polygon
sgrass <- shps[['sgpts_2006_820.shp']] # 820 segment seagrass depth point
# sgrass <- sgrass[sample(1:nrow(sgrass), 2000, replace = F),]

set.seed(4321)
est_pts <- grid_est(seg, spacing = 0.02)
test_pt <- est_pts[27, ]

buff_pts <- buff_ext(sgrass, test_pt, buff = 0.02)

doc_in <- data.frame(buff_pts)
dat <- doc_est(doc_in)

##
# plots 

# base plot if no estimate is available
pa <- plot(dat, baseonly = T)

# base plot with logistic curve
pb <- plot(dat, logisonly = T)
  
# complete plot
pc <- plot(dat)

pdf('figs/est_ex.pdf', height = 4.5, width = 8.5, family = 'serif')

print(pa)
print(pb)
print(pc)

dev.off()
    
@

% example of depth of col ests for wbid - big bend 820
\begin{figure}
\centering
\subfloat[][Proportion of points with seagrass by depth]{
\includegraphics[page=1,width=0.5\textwidth]{figs/est_ex.pdf}
\label{fig:est_ex1}
}

\subfloat[][Logistic growth curve fit through points]{
\includegraphics[page=2,width=0.5\textwidth]{figs/est_ex.pdf}
\label{fig:est_ex2}
}

\subfloat[][Depth estimates]{
\includegraphics[page=3,width=0.5\textwidth]{figs/est_ex.pdf}
\label{fig:est_ex3}
}
\caption{Methods for estimating seagrass depth of colonization using sampled seagrass depth points around a single location. \Cref{fig:est_ex1} is the proportion of points with seagrass by depth using depth points within the buffer of the test location in \cref{fig:buff_ex}.  \Cref{fig:est_ex2} adds a decreasing logistic growth curve fit through the points.  \Cref{fig:est_ex3} shows three depth estimates based on a linear curve through the inflection point of logistic growth curve, including 95\% confidence intervals based on the lighter green area around the linear curve.}
\label{fig:est_ex}
\end{figure}

% grid examples for each segment
<<all_ests, echo = F, cache = T, results = 'hide', eval = T>>=

options(digits = 2)

##
# load data
# ests out created in chunk for table 'tab:est_summ'
data(shps)
data(ests_out)

##
# make plots

# colors and pt_sz
col_vals <- c('blue', 'lightblue', 'yellow', 'brown')
pt_sz <- 2
  
# segments for plotting
all_segs <- shps[grepl('^seg_', names(shps))]
all_segs <- lapply(all_segs, fortify)
all_segs <- do.call('rbind', all_segs)
all_segs$group <- gsub('^seg_|\\.shp\\.[0-9]*$', '', row.names(all_segs))
all_segs$group <- factor(all_segs$group, levels = c('820', '902', '1502', '303'), 
  labels = c('BB', 'OTB', 'UIRL', 'WCB'))
all_segs$group <- as.character(all_segs$group)
levs <- sort(unique(all_segs$group))

levels(ests_out$seg) <- c('WCB', 'BB', 'OTB', 'UIRL')

# assign plots by segment and doc est
for(i in 1:length(levs)){
  
  # subset segment shapefiles and ests by segment
  seg_sub <- all_segs[all_segs$group %in% levs[i], ]
  est_sub <- ests_out[ests_out$seg %in% levs[i], ]
  
  # points to plot
  pt_plo <- data.frame(est_sub[, c('seg', 'long', 'lat', 'z_cmax', 'confint')])
  
  # segment base plot
  p_seg <- ggplot(seg_sub, aes(x = long, y = lat)) +
    geom_polygon(fill = NA, colour = 'black') + 
    coord_fixed() +
    theme_classic() +
    theme(axis.title = element_blank(), axis.text = element_text(size = 6), 
      axis.text.x = element_text(angle = 90, vjust = 0.5),
      plot.margin=unit(c(0, 0, 0, 0), "cm")) + 
    scale_x_continuous(labels = fmt()) + 
    scale_y_continuous(labels = fmt())
  
  # z_cmax
  pa <- p_seg +
    geom_point(data = pt_plo, aes(x = long, y = lat, colour = z_cmax), 
      size = pt_sz) +
    scale_colour_gradientn(colours = col_vals) +
    theme(legend.title = element_blank())

  # confint
  pb <- p_seg +
    geom_point(data = pt_plo, aes(x = long, y = lat, colour = confint), 
      size = pt_sz) +
    scale_colour_gradientn(colours = col_vals) +
    theme(legend.title = element_blank())

  # legends
  paleg <- g_legend(pa)
  pbleg <- g_legend(pb)
  pa <- pa + theme(legend.position = 'none')
  pb <- pb + theme(legend.position = 'none')
  
  # assign to global
  assign(paste0('pa', i), pa)
  assign(paste0('paleg', i), paleg)
  assign(paste0('pb', i), pb)
  assign(paste0('pbleg', i), pbleg)
  
  }

# labels
lab1 <- expression(italic(Z ['c, max']))
lab2 <- '95% confidence'

# arrange all as grob
grobwidths <- c(1, 0.3, 1, 0.3)

pdf('figs/all_ests.pdf', height = 8.5, width = 7, family = 'serif')
grid.arrange(
  arrangeGrob(textGrob(lab1), textGrob(lab2), ncol = 2, widths = sum(grobwidths)/2), 
  arrangeGrob(pa1, paleg1, pb1, pbleg1, ncol = 4, widths = grobwidths),
  arrangeGrob(pa2, paleg2, pb2, pbleg2, ncol = 4, widths = grobwidths),
  arrangeGrob(pa3, paleg3, pb3, pbleg3, ncol = 4, widths = grobwidths),
  arrangeGrob(pa4, paleg4, pb4, pbleg4, ncol = 4, widths = grobwidths),
  ncol = 1, heights = c(0.2, 1,1,1.25,1)
)
dev.off()

@
\begin{figure}
\centering
\includegraphics[width = 0.95\textwidth]{figs/all_ests.pdf}
\caption{Spatially-resolved estimates of seagrass depth limits (m) for four coastal segments of Florida. Maximum depth of colonization ($Z_{c,\,max}$) estimates are on the left and correspondings widths of the 95\% confidence intervals are on the right.  Estimates are assigned to grid locations for each segment, where grid spacing was fixed at 0.02 decimal degrees.  Radii for sampling seagrass bathymetric data around each grid location were fixed at 0.06 decimal degrees. From top to bottom: Big Bend, Old Tampa Bay, Upper Indian R. Lagoon, Western Choctawhatchee Bay.}
\label{fig:all_ests}
\end{figure}

% satellite estimates of water clarity for choc bay
<<kd_choc, echo = F, eval = T, cache = T, results = 'hide'>>=
options(digits = 7) 

# load data
data(choc_seg)
data(choc_sats_crc)

# clip sats_melt

sats_melt <- reshape2::melt(choc_sats_crc[['sats_all']], id.var = c('lat', 'lon'))

# color ramp
cols <- c('blue', 'lightblue', 'yellow', 'brown')

# prep data

to_plo <- sats_melt
to_plo$variable <- factor(to_plo$variable, labels = c('Average', seq(2003, 2007)))
seg_plo <- fortify(choc_seg)

# leg lab
leg_lab <- expression(paste(italic(K [d]), ' (', m^-1, ')')) 

# make plot
p <- ggplot(data = seg_plo) +
  geom_polygon(aes(x = long, y = lat, group = group), 
    colour = 'black', fill = colors()[245]) +
  geom_tile(data = subset(to_plo, !is.na(value)), 
    aes(x = lon, y = lat, fill = value, colour = value)
  ) +
  geom_polygon(aes(x = long, y = lat, group = group), 
    colour = 'black', fill = NA) +
  coord_equal() +
  facet_wrap(~ variable, ncol = 2) + 
  scale_colour_gradientn(leg_lab, colours = cols) +
  scale_fill_gradientn(leg_lab, colours = cols) +
  scale_x_continuous(expand = c(0,0)) + 
  scale_y_continuous(expand = c(0,0)) +
  theme_classic() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(), 
    axis.title.x = element_blank(), 
    axis.title.y = element_blank(),
    axis.text.x = element_text(size = 8), 
    axis.text.y = element_text(size = 8),
    legend.position = 'top', 
    legend.text = element_text(size = 6)
    )

pdf('figs/kd_choc.pdf', height = 4, width = 6, family = 'serif')
p
dev.off()
@
\begin{figure}
\centering
\includegraphics[width = \textwidth]{figs/kd_choc.pdf}
\caption{Satellite estimated light attenuation for Choctawhatchee Bay.  Each facet is an annual average of light attenuation for available years of satellite data up to the year of seagrass coverage used to estimate depth of colonization.  The first facet is an average of all years.  See \cref{fig:light_choc} for segment identification.}
\label{fig:kd_choc}
\end{figure}

% satellite estimates of water clarity for Tampa Bay
<<clarity_tb, echo = F, eval = T, cache = T, results = 'hide'>>=
options(digits = 7) 

# load data
data(tb_seg)
data(tb_sats)
sats_melt <- reshape2::melt(tb_sats[['sats_all']], id.var = c('lat', 'lon'))

# color ramp
cols <- rev(c('blue', 'lightblue', 'yellow', 'brown'))

# prep data
to_plo <- sats_melt
to_plo$variable <- factor(to_plo$variable, labels = c('Average', seq(2006, 2010)))
seg_plo <- fortify(tb_seg)

# leg lab
leg_lab <- 'Clarity (m)'

# make plot
p <- ggplot(data = seg_plo) +
  geom_polygon(aes(x = long, y = lat, group = group), 
    colour = 'black', fill = colors()[245]) +
  geom_tile(data = subset(to_plo, !is.na(value)), 
    aes(x = lon, y = lat, fill = value, colour = value)
  ) +
  geom_polygon(aes(x = long, y = lat, group = group), 
    colour = 'black', fill = NA) +
  coord_equal() +
  facet_wrap(~ variable) + 
  scale_colour_gradientn(leg_lab, colours = cols) +
  scale_fill_gradientn(leg_lab, colours = cols) +
  scale_x_continuous(expand = c(0,0)) + 
  scale_y_continuous(expand = c(0,0)) +
  theme_classic() +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(), 
    axis.title.x = element_blank(), 
    axis.title.y = element_blank(),
    axis.text.x = element_text(size = 8), 
    axis.text.y = element_text(size = 8), 
    legend.position = 'top'
    )

pdf('figs/clarity_tb.pdf', height = 7.5, width = 7, family = 'serif')
p
dev.off()
@
\begin{figure}
\centering
\includegraphics[width = \textwidth]{figs/clarity_tb.pdf}
\caption{Satellite estimated water clarity for Tampa Bay.  Each facet is an annual average of water clarity for available years of satellite data. The first facet is an average of all years.  See \cref{fig:light_tb} for segment identification.}
\label{fig:clarity_tb}
\end{figure}

% estimated light requirements for Choctawhatchee Bay
<<light_choc, echo = F, eval = T, cache = T, include = FALSE, results = 'hide'>>=

# source('R/funcs.r')
# 
# # load data
# data(choc_sats_crc)
# data(choc_seg)
# data(sgpts_2007_choc)
# ave_rast <- choc_sats_crc[['ave_rast']]
# 
# # create sampling grid, 0.01 dec degree spacing
# choc_grd <- grid_est(choc_seg, 0.005)
# 
# # sample the satellit clarity raster
# samp_vals <- raster::extract(ave_rast, choc_grd, df = TRUE)[, -1]
# samp_vals <- na.omit(samp_vals)
# names(samp_vals) <- c('KD', 'Longitude', 'Latitude')
# coordinates(samp_vals) <- c('Longitude', 'Latitude')
# 
# # process for seagrass depth limits and light requirements
# proc <- kd_doc(samp_vals, sgpts_2007_choc, choc_seg, radius = 0.04, trace = T)
# dat <- na.omit(proc)
# 
# choc_light <- dat
# save(choc_light, file = 'data/choc_light.RData')

# reset digits to default
options(digits = 7)

data(choc_light)
data(choc_seg)

# centroids for labels
labs <- data.frame(rgeos::gCentroid(choc_seg, byid = T))
labs$seg <- choc_seg$seg

fill_col <- colors()[245]

# format data, remove outliers
dat <- data.frame(choc_light)
dat$seg <- factor(dat$seg, levels = c('WCB', 'CCB', 'ECB'))
dat <- dat[dat$light < 80, ]


# color ramp for all graphs
pt_cols <- c('blue', 'lightblue', 'yellow', 'brown')

# legend formatting, z_cmax
scls <- c(2, 9)
scl_vals <- scales::rescale(dat[, c('z_c_all'), drop = F], to = scls)
leg_brks <- seq(min(dat$z_c_all, na.rm =  T), max(dat$z_c_all, na.rm = T), length = 6)
leg_labs <- form_fun(leg_brks, 2, 2, 2)

# map, z_cmax
p1 <- ggplot(fortify(choc_seg), aes(long, lat)) + 
  geom_polygon(colour = 'black', fill = fill_col, aes(group = group)) +
  geom_point(data = dat, aes(x = Longitude, y = Latitude, 
    colour = z_c_all), fill = 'black', alpha = 0.8, size = 3) +
  geom_text(data = labs, aes(label = seg, x = x, y = y)) +
  theme_classic() +
  coord_equal() +
  scale_x_continuous(labels = fmt()) + 
  xlab('Longitude') +
  scale_y_continuous(labels = fmt()) + 
  ylab('Latitude') +
  scale_size(name = bquote(italic('Z' ['c, max'])), range = scls, 
    breaks = leg_brks, 
    labels = leg_labs) + 
  scale_colour_gradientn(name = bquote(italic('Z' ['c, max'])), 
    colours = rev(pt_cols),
    breaks = leg_brks, labels = leg_labs) +
  guides(colour = guide_legend(), size = guide_legend()) + 
  guides(colour = guide_legend(), size = guide_legend())

p1leg <- g_legend(p1)
p1 <- p1 + theme(legend.position = 'none')

# boxplots by seg, z_cmax
# reorder seg labels
p2 <- ggplot(dat, aes(x = seg, y = z_c_all)) + 
  geom_boxplot(fill = fill_col, width = 0.6) + 
  ylab(bquote(italic('Z' ['c, max']))) +
  theme_classic() +
  theme(axis.title.x = element_blank())

# legend formatting, light requirements
scls <- c(2, 9)
scl_vals <- scales::rescale(dat[, c('light'), drop = F], to = scls)
leg_brks <- seq(min(dat$light, na.rm =  T), max(dat$light, na.rm = T), length = 6)
leg_labs <- form_fun(leg_brks, 2, 2, 2)
  
# map, light requirements
p3 <- ggplot(fortify(choc_seg), aes(long, lat)) + 
  geom_polygon(colour = 'black', fill = fill_col, aes(group = group)) +
  geom_point(data = dat, aes(x = Longitude, y = Latitude, 
    colour = light), fill = 'black', alpha = 0.8, size = 3) +
  geom_text(data = labs, aes(label = seg, x = x, y = y)) +
  theme_classic() +
  coord_equal() +
  scale_x_continuous(labels = fmt()) + 
  xlab('Longitude') +
  scale_y_continuous(labels = fmt()) + 
  ylab('Latitude') +
  scale_size(name = '% light\nrequirements', range = scls, breaks = leg_brks, 
    labels = leg_labs) + 
  scale_colour_gradientn(name = '% light\nrequirements', 
    colours = pt_cols,
    breaks = leg_brks, labels = leg_labs) +
  guides(colour = guide_legend(), size = guide_legend()) + 
  guides(colour = guide_legend(), size = guide_legend())

p3leg <- g_legend(p3)
p3 <- p3 + theme(legend.position = 'none')

# boxplots, light requirements
p4 <- ggplot(dat, aes(x = seg, y = light)) + 
  geom_boxplot(fill = fill_col, width = 0.6) + 
  ylab('% light requirements') +
  theme_classic() +
  theme(axis.title.x = element_blank())

# for filler
blankPanel <- grid.rect(gp=gpar(col="white"))

# align
# Get the widths
pA <- ggplot_gtable(ggplot_build(p1))
pB <- ggplot_gtable(ggplot_build(p2))
pC <- ggplot_gtable(ggplot_build(p3))
pD <- ggplot_gtable(ggplot_build(p4))
maxWidth = unit.pmax(pA$widths[2:3], pB$widths[2:3], pD$widths[2:3], pD$widths[2:3])

# Set the widths
pA$widths[2:3] <- maxWidth
pB$widths[2:3] <- maxWidth
pC$widths[2:3] <- maxWidth
pD$widths[2:3] <- maxWidth

pdf('figs/light_choc.pdf', height = 8, width = 8, family = 'serif')
grid.arrange(pA, p1leg, pB, blankPanel, pC, p3leg, pD, blankPanel, 
  ncol = 2, nrow = 4, 
  widths = c(1, 0.2), heights = c(1, 0.7, 1, 0.7))
dev.off()
@
\begin{figure}
\centering
\includegraphics[width = 0.95\textwidth]{figs/light_choc.pdf}
\caption{Estimated maximum depths of seagrass colonization and light requirements for multiple locations in Choctawhatchee Bay, Florida. Locations are those where water clarity estimates were available from satellite observations and seagrass depth of colonization was estimable using a radius of 0.04 decimal degrees.  Estimates are also summarized by bay segment as boxplots where the dimensions are the 25\textsuperscript{th} percentile, median, and 75\textsuperscript{th} percentile.  Whiskers extend beyond the boxes as 1.5 multiplied by the interquartile range. CCB: Central Choctawhatchee Bay, ECB: East Choctawhatchee Bay, WCB: West Choctawhatchee Bay.}
\label{fig:light_choc}
\end{figure}

% estimated light requirements for Tampa Bay
<<light_tb, echo = F, eval = T, cache = T, results = 'hide'>>=

# source('R/funcs.r')
# 
# # load data
# data(tb_sats)
# data(tb_seg)
# data(sgpts_2010_tb)
# ave_rast <- tb_sats[['ave_rast']]
# 
# # create sampling grid, 0.01 dec degree spacing
# tb_grd <- grid_est(tb_seg, 0.01)
# 
# # sample the satellit clarity raster
# samp_vals <- raster::extract(ave_rast, tb_grd, sp = T) %>% 
#   data.frame  
# names(samp_vals) <- c('clarity', 'Longitude', 'Latitude')
# coordinates(samp_vals) <- c('Longitude', 'Latitude')
# 
# # process for seagrass depth limits and light requirements
# proc <- secc_doc(samp_vals, sgpts_2010_tb, tb_seg, seg_pts_yr = 2010, radius = 0.1, trace = T)
# dat <- na.omit(proc)
# 
# tb_light <- dat
# save(tb_light, file = 'data/tb_light.RData')

# reset digits to default
options(digits = 7)

data(tb_light)
data(tb_seg)

# centroids for labels
labs <- data.frame(rgeos::gCentroid(tb_seg, byid = T))
labs$seg <- c('HB', 'LTB', 'MTB', 'OTB')

fill_col <- colors()[245]

# format data, remove outliers
dat <- data.frame(tb_light)
# outs <- quantile(dat$light, c(0.05, 0.95))
# dat <- dat[dat$light > outs[1] & dat$light < outs[2],]

# color ramp for all graphs
pt_cols <- c('blue', 'lightblue', 'yellow', 'brown')

# legend formatting, z_cmax
scls <- c(2, 9)
scl_vals <- scales::rescale(dat[, c('z_c_all'), drop = F], to = scls)
leg_brks <- seq(min(dat$z_c_all, na.rm =  T), max(dat$z_c_all, na.rm = T), length = 6)
leg_labs <- form_fun(leg_brks, 2, 2, 2)

# map, z_cmax
p1 <- ggplot(fortify(tb_seg), aes(long, lat)) + 
  geom_polygon(colour = 'black', fill = fill_col, aes(group = group)) +
  geom_point(data = dat, aes(x = Longitude, y = Latitude, 
    colour = z_c_all), fill = 'black', alpha = 0.8) +
  geom_text(data = labs, aes(label = seg, x = x, y = y)) +
  theme_classic() +
  coord_equal() +
  scale_x_continuous(labels = fmt()) + 
  xlab('Longitude') +
  scale_y_continuous(labels = fmt()) + 
  ylab('Latitude') +
  scale_size(name = bquote(italic('Z' ['c, max'])), range = scls, 
    breaks = leg_brks, 
    labels = leg_labs) + 
  scale_colour_gradientn(name = bquote(italic('Z' ['c, max'])), 
    colours = rev(pt_cols),
    breaks = leg_brks, labels = leg_labs) +
  guides(colour = guide_legend(), size = guide_legend()) + 
  guides(colour = guide_legend(), size = guide_legend())

p1leg <- g_legend(p1)
p1 <- p1 + theme(legend.position = 'none')

# boxplots by seg, z_cmax
# reorder seg labels
segs <- c('LTB', 'MTB', 'HB', 'OTB')
dat$seg <- factor(dat$seg, levels = segs) 
p2 <- ggplot(dat, aes(x = seg, y = z_c_all)) + 
  geom_boxplot(fill = fill_col) + 
  ylab(bquote(italic('Z' ['c, max']))) +
  theme_classic() +
  theme(axis.title.y = element_blank()) + 
  coord_flip()

# legend formatting, light requirements
scls <- c(2, 9)
scl_vals <- scales::rescale(dat[, c('light'), drop = F], to = scls)
leg_brks <- seq(min(dat$light, na.rm =  T), max(dat$light, na.rm = T), length = 6)
leg_labs <- form_fun(leg_brks, 2, 2, 2)
  
# map, light requirements
p3 <- ggplot(fortify(tb_seg), aes(long, lat)) + 
  geom_polygon(colour = 'black', fill = fill_col, aes(group = group)) +
  geom_point(data = dat, aes(x = Longitude, y = Latitude, 
    colour = light), fill = 'black', alpha = 0.8) +
  geom_text(data = labs, aes(label = seg, x = x, y = y)) +
  theme_classic() +
  coord_equal() +
  scale_x_continuous(labels = fmt()) + 
  xlab('Longitude') +
  scale_y_continuous(labels = fmt()) + 
  ylab('Latitude') +
  scale_size(name = '% light\nrequirements', range = scls, breaks = leg_brks, 
    labels = leg_labs) + 
  scale_colour_gradientn(name = '% light\nrequirements', 
    colours = pt_cols,
    breaks = leg_brks, labels = leg_labs) +
  guides(colour = guide_legend(), size = guide_legend()) + 
  guides(colour = guide_legend(), size = guide_legend())

p3leg <- g_legend(p3)
p3 <- p3 + theme(legend.position = 'none')

# boxplots, light requirements
p4 <- ggplot(dat, aes(x = seg, y = light)) + 
  geom_boxplot(fill = fill_col) + 
  ylab('% light requirements') +
  theme_classic() +
  theme(axis.title.y = element_blank()) + 
  coord_flip()

pdf('figs/light_tb.pdf', height = 7.5, width = 7, family = 'serif')
grid.arrange(p1, p1leg, p2, p3, p3leg, p4, ncol = 3, nrow = 2, 
  widths = c(1, 0.3, 0.75))
dev.off()
@
\begin{figure}
\centering
\includegraphics[width = 0.95\textwidth]{figs/light_tb.pdf}
\caption{Estimated maximum depths of seagrass colonization and light requirements for multiple locations in Tampa Bay, Florida. Locations are those where water clarity estimates were available from satellite observations and seagrass depth of colonization was estimable using a radius of 0.1 decimal degrees.  Estimates are also summarized by bay segment as boxplots as in \cref{fig:light_choc}. HB: Hillsborough Bay, LTB: Lower Tampa Bay, MTB: Middle Tampa Bay, OTB: Old Tampa Bay.}
\label{fig:light_tb}
\end{figure}

% estimated light requirements for Indian River Lagoon
<<light_irl, echo = F, eval = T, cache = T, results = 'hide'>>=

# source('R/funcs.r')
# 
# # irl polygon segment
# data(irl_seg)
# 
# # irl secchi data
# data(secc_all)
# 
# # irl seagrass points
# data(sgpts_2009_irl)
# 
# # select only years within last ten of seagrass survey
# yrs <- strftime(secc_all$Date, '%Y') %>% 
#   as.numeric
# yrs <- yrs <= 2009 & yrs > 1999
# secc_all <- secc_all[yrs, ]
# 
# # remove stations with less than five observations
# rems <- table(secc_all$Station_ID)
# rems <- names(rems)[rems < 5]
# secc_all <- secc_all[!secc_all$Station_ID %in% rems, ]
# 
# # process, get ave secchi data results
# proc <- secc_doc(secc_all, sgpts_2009_irl, irl_seg, radius = 0.15, seg_pts_yr = '2009', trace = T)
# dat <- na.omit(proc)
# 
# #remote bad secchi values and low conf
# dat <- dat[dat$light > 4 & dat$maxd_conf < 1 , ] 
# 
# irl_light <- dat
# save(irl_light, file = 'data/irl_light.RData')

# reset digits to default
options(digits = 7)

data(irl_light)

data(irl_seg)

# centroids for labels, offset
labs <- data.frame(rgeos::gCentroid(irl_seg, byid = T, id = irl_seg$seg))
labs$x <- labs$x - 0.3
labs$seg <- rownames(labs)
labs <- labs[!labs$seg %in% c('LSL', 'LHR'), ]

fill_col <- colors()[245]

# format data, remove outliers
dat <- data.frame(irl_light)

# color ramp for all graphs
pt_cols <- c('blue', 'lightblue', 'yellow', 'brown')

# legend formatting, z_cmax
scls <- c(2, 9)
scl_vals <- scales::rescale(dat[, c('z_c_all'), drop = F], to = scls)
leg_brks <- seq(min(dat$z_c_all, na.rm =  T), max(dat$z_c_all, na.rm = T), length = 6)
leg_labs <- form_fun(leg_brks, 2, 2, 2)

# map, z_cmax
p1 <- ggplot(fortify(irl_seg), aes(long, lat)) + 
  geom_polygon(colour = 'black', fill = fill_col, aes(group = group)) +
  geom_point(data = dat, aes(x = Longitude, y = Latitude, 
    colour = z_c_all), size = 3, fill = 'black', alpha = 0.8) +
  geom_text(data = labs, aes(label = seg, x = x, y = y)) +
  theme_classic() +
  coord_equal() +
  scale_x_continuous(limits = c(-81.3, -80)) + 
  xlab('Longitude') +
  scale_y_continuous() + 
  ylab('Latitude') +
  scale_size(name = bquote(italic('Z' ['c, max'])), range = scls, breaks = leg_brks, 
    labels = leg_labs) + 
  scale_colour_gradientn(name = bquote(italic('Z' ['c, max'])), 
    colours = rev(pt_cols),
    breaks = leg_brks, labels = leg_labs) +
  guides(colour = guide_legend(), size = guide_legend()) + 
  guides(colour = guide_legend(), size = guide_legend())

p1leg <- g_legend(p1)
p1 <- p1 + theme(legend.position = 'none')

# boxplots by seg, z_cmax
# reorder seg labels
segs <- c('LSL', 'LIRL', 'LCIRL', 'UCIRL', 'BR', 'UIRL', 'LML', 'UML')
dat$seg <- factor(dat$seg, levels = segs) 
p2 <- ggplot(dat, aes(x = seg, y = z_c_all)) + 
  geom_boxplot(fill = fill_col) + 
  ylab(bquote(italic('Z' ['c, max']))) +
  theme_classic() +
  theme(axis.title.y = element_blank()) + 
  coord_flip()

# legend formatting, light requirements
scls <- c(2, 9)
scl_vals <- scales::rescale(dat[, c('light'), drop = F], to = scls)
leg_brks <- seq(min(dat$light, na.rm =  T), max(dat$light, na.rm = T), length = 6)
leg_labs <- form_fun(leg_brks, 2, 2, 2)
  
# map, light requirements
p3 <- ggplot(fortify(irl_seg), aes(long, lat)) + 
  geom_polygon(colour = 'black', fill = fill_col, aes(group = group)) +
  geom_point(data = dat, aes(x = Longitude, y = Latitude, 
    colour = light), size = 3, fill = 'black', alpha = 0.8) +
  geom_text(data = labs, aes(label = seg, x = x, y = y)) +
  theme_classic() +
  coord_equal() +
  scale_x_continuous(limits = c(-81.3, -80)) + 
  xlab('Longitude') +
  scale_y_continuous() + 
  ylab('Latitude') +
  scale_size(name = '% light\nrequirements', range = scls, breaks = leg_brks, 
    labels = leg_labs) + 
  scale_colour_gradientn(name = '% light\nrequirements', 
    colours = pt_cols,
    breaks = leg_brks, labels = leg_labs) +
  guides(colour = guide_legend(), size = guide_legend()) + 
  guides(colour = guide_legend(), size = guide_legend())

p3leg <- g_legend(p3)
p3 <- p3 + theme(legend.position = 'none')

# boxplots, light requirements
p4 <- ggplot(dat, aes(x = seg, y = light)) + 
  geom_boxplot(fill = fill_col) + 
  ylab('% light requirements') +
  theme_classic() +
  theme(axis.title.y = element_blank()) + 
  coord_flip()

pdf('figs/light_irl.pdf', height = 8.5, width = 6.5, family = 'serif')
grid.arrange(p1, p1leg, p2, p3, p3leg, p4, ncol = 3, nrow = 2, 
  widths = c(1, 0.3, 0.75))
dev.off()

options(digits = 1)
@
\begin{figure}
\centering
\includegraphics[width = 0.8\textwidth]{figs/light_irl.pdf}
\caption{Estimated maximum depths of seagrass colonization and light requirements for multiple locations in Indian River Lagoon, Florida.  Map locations are georeferenced observations of water clarity in the Florida \acl{IWR} database, update 40.  Estimates are also summarized by bay segment as boxplots as in \cref{fig:light_choc}. Light requirements are based on averaged secchi values within ten years of the seagrass coverage data and estimated maximum depth of colonization using a radius of 0.15 decimal degrees for each secchi location to sample seagrass depth points. BR: Banana R., LCIRL: Lower Central Indian R. Lagoon, LIRL: Lower Indian R. Lagoon, LML: Lower Mosquito Lagoon, LSL: Lower St. Lucie, UCIRL: Upper Central Indian R. Lagoon, UIRL: Upper Indian R. Lagoon, UML: Upper Mosquito Lagoon.}
\label{fig:light_irl}
\end{figure}

\end{document}